<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ademruimte - Hyperventilatie Helper</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f9fafb;
            line-height: 1.6;
        }

        header {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
            padding: 2rem 1rem;
            text-align: center;
        }

        header h1 {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .nav-tabs {
            background: white;
            border-bottom: 2px solid #e5e7eb;
            padding: 1rem;
            overflow-x: auto;
            white-space: nowrap;
        }

        .nav-tabs button {
            background: none;
            border: none;
            padding: 0.75rem 1rem;
            margin-right: 0.5rem;
            border-radius: 0.5rem;
            cursor: pointer;
            font-size: 0.875rem;
            transition: all 0.2s;
            white-space: nowrap;
        }

        .nav-tabs button.active {
            background: #dbeafe;
            color: #1d4ed8;
            border: 1px solid #bfdbfe;
        }

        .nav-tabs button:hover {
            background: #f3f4f6;
        }

        .container {
            max-width: 4xl;
            margin: 0 auto;
            padding: 2rem 1rem;
        }

        .card {
            background: white;
            border-radius: 0.5rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            border: 1px solid #e5e7eb;
        }

        .card h2 {
            color: #1f2937;
            margin-bottom: 1rem;
            font-size: 1.5rem;
        }

        .card h3 {
            color: #374151;
            margin-bottom: 0.75rem;
            font-size: 1.125rem;
        }

        .grid {
            display: grid;
            gap: 1rem;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 0.5rem;
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.2s;
            text-align: center;
            display: inline-block;
            text-decoration: none;
        }

        .btn-primary {
            background: #3b82f6;
            color: white;
        }

        .btn-primary:hover {
            background: #2563eb;
        }

        .btn-green {
            background: #10b981;
            color: white;
        }

        .btn-green:hover {
            background: #059669;
        }

        .btn-orange {
            background: #f59e0b;
            color: white;
        }

        .btn-orange:hover {
            background: #d97706;
        }

        .btn-red {
            background: #ef4444;
            color: white;
        }

        .btn-red:hover {
            background: #dc2626;
        }

        .btn-purple {
            background: #8b5cf6;
            color: white;
        }

        .btn-purple:hover {
            background: #7c3aed;
        }

        .alert {
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
        }

        .alert-info {
            background: #dbeafe;
            border: 1px solid #bfdbfe;
            color: #1e40af;
        }

        .alert-success {
            background: #d1fae5;
            border: 1px solid #a7f3d0;
            color: #065f46;
        }

        .alert-warning {
            background: #fef3c7;
            border: 1px solid #fde68a;
            color: #92400e;
        }

        .alert-danger {
            background: #fee2e2;
            border: 1px solid #fecaca;
            color: #991b1b;
        }

        .status-connected {
            color: #059669;
            font-size: 0.75rem;
        }

        .status-disconnected {
            color: #f59e0b;
            font-size: 0.75rem;
        }

        .status-error {
            color: #ef4444;
            font-size: 0.75rem;
        }

        .hidden {
            display: none !important;
        }

        footer {
            text-align: center;
            padding: 2rem;
            color: #6b7280;
            font-size: 0.875rem;
        }

        @media (max-width: 768px) {
            header {
                padding: 1rem;
            }
            
            header h1 {
                font-size: 1.5rem;
            }
            
            .container {
                padding: 1rem;
            }
            
            .card {
                padding: 1rem;
            }
            
            .grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>ü´Å Ademruimte</h1>
        <p>Jouw persoonlijke hyperventilatie helper</p>
        <div id="firebase-status" class="status-disconnected">
            üî• Firebase: Initialiseren...
        </div>
    </header>

    <nav class="nav-tabs">
        <button class="tab-btn active" data-tab="dashboard">üè† Dashboard</button>
        <button class="tab-btn" data-tab="dagboek">üìñ Dagboek</button>
    </nav>

    <div class="container">
        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content">
            <div class="card">
                <h2>Welkom bij Ademruimte</h2>
                <p>Jouw persoonlijke hulp voor het omgaan met hyperventilatie en luchthonger-gevoelens.</p>
            </div>

            <div class="alert alert-info">
                <strong>üî• Firebase Status:</strong><br>
                <span id="connection-details">Bezig met verbinden...</span>
                <br><br>
                <button class="btn btn-primary" onclick="testFirebaseConnection()">
                    üîó Test Firebase Connectie
                </button>
                <button class="btn btn-green" onclick="testFirestoreWrite()" style="margin-left: 0.5rem;">
                    ‚úçÔ∏è Test Schrijven
                </button>
                <button class="btn btn-orange" onclick="testFirestoreRead()" style="margin-left: 0.5rem;">
                    üìñ Test Lezen
                </button>
            </div>

            <div class="grid">
                <div class="card">
                    <h3>üö® Crisis Hulp</h3>
                    <p>Voor wanneer je luchthonger voelt opkomen</p>
                    <button class="btn btn-red" onclick="addTestEntry('Crisis Hulp')">Simuleer Crisis Entry</button>
                </div>

                <div class="card">
                    <h3>üìñ Dagboek</h3>
                    <p>Bijhouden van patronen</p>
                    <button class="btn btn-primary" onclick="showTab('dagboek')">Open Dagboek</button>
                </div>
            </div>
        </div>

        <!-- Dagboek Tab -->
        <div id="dagboek" class="tab-content hidden">
            <div class="card">
                <h2>üìñ Dagboek</h2>
                <p>Overzicht van je sessies en vooruitgang</p>
                <div style="margin-top: 1rem;">
                    <button class="btn btn-primary" onclick="addTestEntry('Handmatige Entry')">
                        ‚ûï Test Entry Toevoegen
                    </button>
                    <button class="btn btn-green" onclick="loadDagboekEntries()" style="margin-left: 0.5rem;">
                        üîÑ Vernieuw
                    </button>
                    <button class="btn btn-red" onclick="clearAllEntries()" style="margin-left: 0.5rem;">
                        üóëÔ∏è Alles Wissen
                    </button>
                </div>
            </div>

            <div id="dagboek-entries">
                <!-- Entries worden hier geladen -->
            </div>
        </div>
    </div>

    <footer>
        <p>üìû In noodgevallen: contacteer altijd je huisarts of spoeddiensten</p>
    </footer>

    <!-- Firebase en App JavaScript -->
    <script type="module">
        // Import Firebase modules
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, orderBy, query, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

        // Firebase configuratie
        const firebaseConfig = {
            apiKey: "AIzaSyBwDkmbKOzZAyIZW7-ud4qYr7xHyILCdzI",
            authDomain: "ademruimte-12c09.firebaseapp.com",
            projectId: "ademruimte-12c09",
            storageBucket: "ademruimte-12c09.firebasestorage.app",
            messagingSenderId: "744941871331",
            appId: "1:744941871331:web:c3ce24d814fe41314d25d6",
            measurementId: "G-SD2ZEYNMNY"
        };

        // Initialize Firebase
        let app, db;
        let isFirebaseConnected = false;

        try {
            app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            isFirebaseConnected = true;
            
            updateStatus('connected', 'üî• Firebase: Verbonden');
            updateConnectionDetails('‚úÖ App ge√Ønitialiseerd<br>‚úÖ Firestore database verbonden<br>‚úÖ Klaar voor gebruik');
            
            console.log('‚úÖ Firebase successfully initialized');
            
        } catch (error) {
            console.error('‚ùå Firebase initialization error:', error);
            updateStatus('error', 'üî• Firebase: Initialisatie fout');
            updateConnectionDetails('‚ùå Fout: ' + error.message);
        }

        // Helper functies
        function updateStatus(type, message) {
            const statusElement = document.getElementById('firebase-status');
            statusElement.textContent = message;
            statusElement.className = `status-${type}`;
        }

        function updateConnectionDetails(html) {
            document.getElementById('connection-details').innerHTML = html;
        }

        // Firebase functies
        async function saveToFirestore(entry) {
            if (!isFirebaseConnected) {
                throw new Error('Firebase niet verbonden');
            }

            try {
                const docRef = await addDoc(collection(db, "dagboekEntries"), {
                    ...entry,
                    timestamp: serverTimestamp(),
                    userId: "demo-user"
                });
                
                console.log('‚úÖ Entry saved with ID:', docRef.id);
                return { id: docRef.id, success: true };
                
            } catch (error) {
                console.error('‚ùå Error saving to Firestore:', error);
                throw error;
            }
        }

        async function loadFromFirestore() {
            if (!isFirebaseConnected) {
                throw new Error('Firebase niet verbonden');
            }

            try {
                const q = query(collection(db, "dagboekEntries"), orderBy("timestamp", "desc"));
                const querySnapshot = await getDocs(q);
                
                const entries = [];
                querySnapshot.forEach((doc) => {
                    const data = doc.data();
                    entries.push({
                        id: doc.id,
                        ...data,
                        tijdstempel: data.timestamp ? data.timestamp.toDate().toLocaleString('nl-BE') : 'Onbekend',
                        bron: "Firebase"
                    });
                });
                
                console.log('‚úÖ Loaded', entries.length, 'entries from Firestore');
                return entries;
                
            } catch (error) {
                console.error('‚ùå Error loading from Firestore:', error);
                throw error;
            }
        }

        async function clearFirestore() {
            if (!isFirebaseConnected) {
                throw new Error('Firebase niet verbonden');
            }

            try {
                const querySnapshot = await getDocs(collection(db, "dagboekEntries"));
                const deletePromises = [];
                
                querySnapshot.forEach((document) => {
                    deletePromises.push(deleteDoc(doc(db, "dagboekEntries", document.id)));
                });
                
                await Promise.all(deletePromises);
                console.log('‚úÖ All entries cleared from Firestore');
                return true;
                
            } catch (error) {
                console.error('‚ùå Error clearing Firestore:', error);
                throw error;
            }
        }

        // Global functies (beschikbaar vanuit HTML)
        window.testFirebaseConnection = async function() {
            try {
                if (!isFirebaseConnected) {
                    alert('‚ùå Firebase is niet ge√Ønitialiseerd');
                    return;
                }

                // Test basic connection
                const testCollection = collection(db, "connectionTest");
                alert('‚úÖ Firebase Connectie Succesvol!\n\n' + 
                      'Firebase App: ‚úì\n' + 
                      'Firestore Database: ‚úì\n' + 
                      'Collectie toegang: ‚úì\n\n' + 
                      'Je kunt nu data opslaan en laden!');
                      
            } catch (error) {
                alert('‚ùå Firebase Connectie Fout:\n\n' + error.message);
                console.error('Connection test failed:', error);
            }
        };

        window.testFirestoreWrite = async function() {
            try {
                const testEntry = {
                    test: true,
                    message: "Firebase connectie test",
                    testTime: new Date().toLocaleString('nl-BE')
                };

                const result = await saveToFirestore(testEntry);
                alert('‚úÖ Schrijf Test Succesvol!\n\n' + 
                      'Test entry opgeslagen met ID: ' + result.id + '\n\n' + 
                      'Firebase schrijfoperaties werken correct!');
                      
            } catch (error) {
                alert('‚ùå Schrijf Test Fout:\n\n' + error.message);
                console.error('Write test failed:', error);
            }
        };

        window.testFirestoreRead = async function() {
            try {
                const entries = await loadFromFirestore();
                alert('‚úÖ Lees Test Succesvol!\n\n' + 
                      'Aantal entries geladen: ' + entries.length + '\n\n' + 
                      'Firebase leesoperaties werken correct!');
                      
                // Update UI if on dagboek tab
                if (document.getElementById('dagboek').classList.contains('hidden') === false) {
                    displayDagboekEntries(entries);
                }
                
            } catch (error) {
                alert('‚ùå Lees Test Fout:\n\n' + error.message);
                console.error('Read test failed:', error);
            }
        };

        window.addTestEntry = async function(techniek) {
            try {
                const entry = {
                    techniekGebruikt: techniek || 'Test Entry',
                    trigger: 'Firebase test entry',
                    intensiteitVoor: Math.floor(Math.random() * 10) + 1,
                    intensiteitNa: Math.floor(Math.random() * 6) + 1,
                    resultaat: ['zeer-goed', 'goed', 'matig'][Math.floor(Math.random() * 3)],
                    notities: 'Dit is een test entry om Firebase functionaliteit te testen',
                    tijdstempel: new Date().toLocaleString('nl-BE'),
                    bron: 'Test'
                };

                await saveToFirestore(entry);
                alert('‚úÖ Test Entry Toegevoegd!\n\nEntry succesvol opgeslagen in Firebase');
                
                // Refresh dagboek if visible
                if (document.getElementById('dagboek').classList.contains('hidden') === false) {
                    await loadDagboekEntries();
                }
                
            } catch (error) {
                alert('‚ùå Fout bij toevoegen entry:\n\n' + error.message);
                console.error('Add entry failed:', error);
            }
        };

        window.loadDagboekEntries = async function() {
            try {
                const entries = await loadFromFirestore();
                displayDagboekEntries(entries);
                
            } catch (error) {
                console.error('Load entries failed:', error);
                document.getElementById('dagboek-entries').innerHTML = 
                    '<div class="alert alert-danger">' +
                        '<strong>‚ùå Fout bij laden entries:</strong><br>' + 
                        error.message +
                    '</div>';
            }
        };

        window.clearAllEntries = async function() {
            if (!confirm('‚ö†Ô∏è Weet je zeker dat je alle entries wilt wissen?\n\nDit kan niet ongedaan worden gemaakt.')) {
                return;
            }

            try {
                await clearFirestore();
                alert('‚úÖ Alle entries gewist!');
                await loadDagboekEntries();
                
            } catch (error) {
                alert('‚ùå Fout bij wissen entries:\n\n' + error.message);
                console.error('Clear entries failed:', error);
            }
        };

        // Helper functies
        function displayDagboekEntries(entries) {
            const container = document.getElementById('dagboek-entries');
            
            if (!entries || entries.length === 0) {
                container.innerHTML = 
                    '<div class="card">' +
                        '<h3>Nog geen entries</h3>' +
                        '<p>Voeg een test entry toe om de Firebase functionaliteit te testen.</p>' +
                    '</div>';
                return;
            }
            
            const entriesHtml = entries.map(entry => {
                return '<div class="card">' +
                    '<div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 1rem;">' +
                        '<div>' +
                            '<div style="font-weight: 600; color: #1f2937;">' + entry.techniekGebruikt + '</div>' +
                            '<div style="font-size: 0.875rem; color: #6b7280;">' +
                                entry.tijdstempel + ' ‚Ä¢ ' +
                                '<span style="color: #3b82f6;">' + entry.bron + '</span>' +
                            '</div>' +
                        '</div>' +
                        '<div style="font-size: 0.875rem; font-weight: 500; color: #059669;">' +
                            getResultaatText(entry.resultaat) +
                        '</div>' +
                    '</div>' +
                    '<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 0.75rem;">' +
                        '<div style="font-size: 0.875rem;">' +
                            '<span style="color: #6b7280;">Voor:</span> ' +
                            '<span style="font-weight: 500;">' + entry.intensiteitVoor + '/10</span>' +
                        '</div>' +
                        '<div style="font-size: 0.875rem;">' +
                            '<span style="color: #6b7280;">Na:</span> ' +
                            '<span style="font-weight: 500;">' + entry.intensiteitNa + '/10</span>' +
                        '</div>' +
                    '</div>' +
                    (entry.trigger ? '<p style="font-size: 0.875rem; margin-bottom: 0.5rem;"><strong>Trigger:</strong> ' + entry.trigger + '</p>' : '') +
                    (entry.notities ? '<p style="font-size: 0.875rem;"><strong>Notities:</strong> ' + entry.notities + '</p>' : '') +
                '</div>';
            }).join('');
            
            container.innerHTML = entriesHtml;
        }

        function getResultaatText(resultaat) {
            const mapping = {
                'zeer-goed': 'Zeer goed',
                'goed': 'Goed', 
                'matig': 'Matig',
                'geen-effect': 'Geen effect',
                'slechter': 'Slechter'
            };
            return mapping[resultaat] || resultaat;
        }

        // Tab switching
        window.showTab = function(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.add('hidden');
            });
            
            // Remove active from all buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName).classList.remove('hidden');
            
            // Set active button
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
            
            // Load content if needed
            if (tabName === 'dagboek') {
                loadDagboekEntries();
            }
        };

        // Tab switching event listeners
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const tab = btn.getAttribute('data-tab');
                showTab(tab);
            });
        });

        // Auto-load dagboek when page loads
        setTimeout(() => {
            if (isFirebaseConnected) {
                loadDagboekEntries();
            }
        }, 1000);

    </script>
</body>
</html>
