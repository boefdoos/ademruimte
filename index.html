<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#06b6d4">
    <meta name="description" content="Ademruimte - Je persoonlijke ruimte voor ademhalingsoefeningen en hyperventilatie begeleiding">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <title>Ademruimte - Hyperventilatie Helper</title>
    
    <!-- Preload kritieke resources -->
    <link rel="preconnect" href="https://www.gstatic.com">
    <link rel="preconnect" href="https://unpkg.com">

<style>
    /* CSS Custom Properties voor consistentie */
    :root {
        --primary-gradient: linear-gradient(135deg, #06b6d4 0%, #10b981 50%, #3b82f6 100%);
        --card-background: rgba(255, 255, 255, 0.95);
        --text-dark: #1f2937;
        --text-light: #6b7280;
        --border-radius: 1rem;
        --shadow-sm: 0 4px 15px rgba(0, 0, 0, 0.1);
        --shadow-md: 0 8px 32px rgba(0, 0, 0, 0.1);
        --transition-base: all 0.3s ease;
        --touch-target: 44px;
    }

    /* Reset en basis styling */
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, "Apple Color Emoji", "Segoe UI Emoji", sans-serif;
        background: var(--primary-gradient);
        min-height: 100vh;
        line-height: 1.6;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        overflow-x: hidden;
    }

    /* Header */
    header {
        background: linear-gradient(135deg, #06b6d4, #10b981);
        color: white;
        padding: clamp(1rem, 3vw, 2rem);
        text-align: center;
        position: relative;
        min-height: 80px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        box-shadow: var(--shadow-md);
        backdrop-filter: blur(10px);
    }

    .logo-container {
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 0.75rem;
        position: relative;
        z-index: 1;
    }

    .logo-svg {
        height: clamp(100px, 12vw, 160px);
        width: auto;
        filter: drop-shadow(0 8px 16px rgba(0,0,0,0.3));
    }

    header h1 {
        font-size: clamp(1.2rem, 4vw, 2rem);
        font-weight: 700;
        margin: 0 0 0.5rem 0;
        letter-spacing: -0.02em;
        text-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    header p {
        font-size: clamp(0.7rem, 2vw, 0.9rem);
        opacity: 0.95;
        margin: 0;
    }

    .user-info {
        position: absolute;
        top: 0.75rem;
        right: 0.75rem;
        font-size: 0.75rem;
        color: rgba(255,255,255,0.9);
        max-width: 120px;
        word-break: break-word;
        text-align: right;
        background: rgba(255,255,255,0.1);
        padding: 0.5rem 0.75rem;
        border-radius: 1rem;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255,255,255,0.2);
        z-index: 2;
    }

    /* Navigation */
    .nav-tabs {
        background: var(--card-background);
        backdrop-filter: blur(20px);
        border-bottom: 2px solid rgba(102, 126, 234, 0.2);
        padding: 0.75rem 0.5rem;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
        box-shadow: var(--shadow-sm);
        scrollbar-width: none;
        -ms-overflow-style: none;
        display: flex;
        gap: 0.5rem;
    }

    .nav-tabs::-webkit-scrollbar {
        display: none;
    }

    .nav-tabs button {
        background: none;
        border: none;
        padding: 0.875rem 1rem;
        border-radius: 1rem;
        cursor: pointer;
        font-size: 0.8rem;
        font-weight: 500;
        transition: var(--transition-base);
        white-space: nowrap;
        min-height: var(--touch-target);
        min-width: 44px;
        touch-action: manipulation;
        color: var(--text-light);
        position: relative;
        outline: none;
        font-family: inherit;
        flex-shrink: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        line-height: 1.2;
    }

    .nav-tabs button:focus-visible {
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.3);
    }

    .nav-tabs button.active {
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
        box-shadow: var(--shadow-sm);
        transform: translateY(-1px);
        font-weight: 600;
    }

    .nav-tabs button:hover:not(.active) {
        background: rgba(102, 126, 234, 0.1);
        color: #667eea;
        transform: translateY(-1px);
    }

    /* Container */
    .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: clamp(1rem, 3vw, 2rem);
        min-height: calc(100vh - 120px);
    }

    /* Cards */
    .card {
        background: var(--card-background);
        backdrop-filter: blur(20px);
        border-radius: var(--border-radius);
        padding: clamp(1rem, 3vw, 2rem);
        margin-bottom: 1.5rem;
        box-shadow: var(--shadow-md);
        border: 1px solid rgba(255, 255, 255, 0.2);
        transition: var(--transition-base);
    }

    .card:hover {
        transform: translateY(-2px);
        box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
    }

    .card h2 {
        color: var(--text-dark);
        margin-bottom: 1rem;
        font-size: clamp(1.25rem, 4vw, 1.75rem);
        font-weight: 700;
        background: linear-gradient(135deg, #06b6d4, #10b981);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    .card h3 {
        color: var(--text-dark);
        margin-bottom: 0.75rem;
        font-size: clamp(1rem, 3vw, 1.25rem);
        font-weight: 600;
    }

    /* Buttons */
    .btn {
        padding: 1rem 1.5rem;
        border: none;
        border-radius: 0.75rem;
        cursor: pointer;
        font-size: 0.95rem;
        font-weight: 600;
        transition: var(--transition-base);
        text-align: center;
        display: inline-block;
        text-decoration: none;
        min-height: var(--touch-target);
        touch-action: manipulation;
        user-select: none;
        position: relative;
        overflow: hidden;
        box-shadow: var(--shadow-sm);
        outline: none;
        font-family: inherit;
    }

    .btn:focus-visible {
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.3), var(--shadow-sm);
    }

    .btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none !important;
    }

    .btn:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
    }

    .btn-primary {
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
    }

    .btn-green {
        background: linear-gradient(135deg, #10b981, #059669);
        color: white;
    }

    .btn-red {
        background: linear-gradient(135deg, #ef4444, #dc2626);
        color: white;
    }

    .btn-cyan {
        background: linear-gradient(135deg, #06b6d4, #0891b2);
        color: white;
    }

    .btn-orange {
        background: linear-gradient(135deg, #f59e0b, #d97706);
        color: white;
    }

    .btn-purple {
        background: linear-gradient(135deg, #8b5cf6, #7c3aed);
        color: white;
    }

    /* Grid */
    .grid {
        display: grid;
        gap: 1.5rem;
        grid-template-columns: repeat(auto-fit, minmax(min(280px, 100%), 1fr));
    }

    .grid .card {
        background: linear-gradient(135deg, rgba(255,255,255,0.9), rgba(255,255,255,0.7));
        border-radius: 1.2rem;
        padding: 2rem;
        text-align: center;
        position: relative;
        overflow: hidden;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .grid .card:hover {
        transform: translateY(-2px);
        box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
    }

    .grid .card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(90deg, #667eea, #764ba2);
        border-radius: 1.2rem 1.2rem 0 0;
    }

    .grid .card h3 {
        font-size: 1.375rem;
        margin-bottom: 1rem;
        font-weight: 700;
        color: var(--text-dark);
    }

    .grid .card p {
        color: var(--text-light);
        margin-bottom: 1.5rem;
        font-size: 0.95rem;
    }

    /* Forms */
    .form-group {
        margin-bottom: 1rem;
    }

    .form-label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: 500;
        color: var(--text-dark);
        font-size: 0.9rem;
    }

    .form-input, .form-select, .form-textarea {
        width: 100%;
        padding: 0.75rem;
        border: 2px solid #e5e7eb;
        border-radius: 0.5rem;
        font-size: 0.9rem;
        min-height: var(--touch-target);
        font-family: inherit;
        transition: border-color 0.2s ease;
        background-color: #ffffff;
    }

    .form-input:focus, .form-select:focus, .form-textarea:focus {
        outline: none;
        border-color: #06b6d4;
        box-shadow: 0 0 0 3px rgba(6, 182, 212, 0.1);
    }

    .form-textarea {
        resize: vertical;
        min-height: 80px;
        line-height: 1.5;
    }

    /* Range input styling */
    .range-input {
        width: 100%;
        margin: 0.75rem 0;
        height: 8px;
        -webkit-appearance: none;
        appearance: none;
        background: #e5e7eb;
        border-radius: 5px;
        outline: none;
    }

    .range-input::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 24px;
        height: 24px;
        background: #3b82f6;
        border-radius: 50%;
        cursor: pointer;
    }

    .range-input::-moz-range-thumb {
        width: 24px;
        height: 24px;
        background: #3b82f6;
        border-radius: 50%;
        cursor: pointer;
        border: none;
    }

    .range-value {
        text-align: center;
        font-weight: bold;
        font-size: 1.25rem;
        color: #3b82f6;
        margin: 0.5rem 0;
    }

    /* Google button */
    .google-btn {
        width: 100%;
        padding: 0.875rem;
        border: 1px solid #d1d5db;
        border-radius: 0.5rem;
        background: white;
        color: #374151;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        font-size: 0.9rem;
        font-weight: 500;
        transition: all 0.2s;
        min-height: var(--touch-target);
    }

    .google-btn:hover:not(:disabled) {
        background: #f9fafb;
        border-color: #9ca3af;
    }

    .google-btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
    }

    /* Alerts */
    .alert {
        padding: 1rem 1.5rem;
        border-radius: 0.75rem;
        margin-bottom: 1rem;
        font-size: 0.9rem;
        border: 1px solid;
        box-shadow: var(--shadow-sm);
    }

    .alert-info {
        background: rgba(219, 234, 254, 0.95);
        border-color: #3b82f6;
        color: #1e40af;
    }

    .alert-success {
        background: rgba(209, 250, 229, 0.95);
        border-color: #10b981;
        color: #065f46;
    }

    .alert-warning {
        background: rgba(254, 243, 199, 0.95);
        border-color: #f59e0b;
        color: #92400e;
    }

    .alert-error {
        background: rgba(254, 226, 226, 0.95);
        border-color: #ef4444;
        color: #991b1b;
    }

    /* User message notifications */
    .user-message {
        position: fixed;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        z-index: 1001;
        max-width: 90vw;
        min-width: 300px;
        padding: 1rem 1.5rem;
        border-radius: 0.75rem;
        font-size: 0.9rem;
        font-weight: 500;
        border: 1px solid;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        backdrop-filter: blur(15px);
        animation: slideInDown 0.3s ease-out;
    }

    @keyframes slideInDown {
        from {
            opacity: 0;
            transform: translateX(-50%) translateY(-20px);
        }
        to {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }
    }

    /* Modals */
    .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.5);
        z-index: 1000;
        padding: 1rem;
    }

    .modal.show {
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .modal-content {
        background: white;
        border-radius: 0.75rem;
        padding: 1.5rem;
        max-width: 400px;
        width: 100%;
        max-height: 90vh;
        overflow-y: auto;
        position: relative;
    }

    .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
    }

    .close-btn {
        background: none;
        border: none;
        font-size: 1.5rem;
        cursor: pointer;
        color: var(--text-light);
        min-width: 40px;
        min-height: 40px;
        border-radius: 50%;
        transition: var(--transition-base);
    }

    .close-btn:hover {
        background: rgba(0,0,0,0.1);
        color: var(--text-dark);
    }

    /* Divider */
    .divider {
        text-align: center;
        margin: 1.5rem 0;
        position: relative;
        color: var(--text-light);
        font-size: 0.875rem;
    }

    .divider::before {
        content: '';
        position: absolute;
        top: 50%;
        left: 0;
        right: 0;
        height: 1px;
        background: #e5e7eb;
        z-index: 1;
    }

    .divider span {
        background: white;
        padding: 0 1rem;
        position: relative;
        z-index: 2;
    }

    /* Loading spinner */
    .spinner {
        display: inline-block;
        width: 1rem;
        height: 1rem;
        border: 2px solid #f3f4f6;
        border-top: 2px solid #3b82f6;
        border-radius: 50%;
        animation: spin 1s linear infinite;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    /* Breathing exercise styling */
    .breath-display {
        font-size: 2rem;
        font-weight: bold;
        text-align: center;
        margin: 1.5rem 0;
        padding: 1.5rem;
        border-radius: 1rem;
        transition: all 0.3s ease;
        min-height: 120px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .breath-display.inhale {
        background: linear-gradient(135deg, #dbeafe, #bfdbfe);
        color: #1e40af;
        transform: scale(1.02);
    }

    .breath-display.exhale {
        background: linear-gradient(135deg, #d1fae5, #a7f3d0);
        color: #065f46;
        transform: scale(0.98);
    }

    .breath-display.hold {
        background: linear-gradient(135deg, #fef3c7, #fde68a);
        color: #92400e;
        transform: scale(1.01);
    }

    .breath-display.rest {
        background: linear-gradient(135deg, #f3f4f6, #e5e7eb);
        color: var(--text-light);
    }

    .breath-display.gentle-breath {
        background: linear-gradient(135deg, #dbeafe, #bfdbfe);
        color: #1e40af;
    }

    .progress-bar {
        width: 100%;
        height: 0.75rem;
        background: #e5e7eb;
        border-radius: 0.375rem;
        overflow: hidden;
        margin: 1rem 0;
    }

    .progress-fill {
        height: 100%;
        background: #10b981;
        border-radius: 0.375rem;
        transition: width 0.3s ease;
    }

    .breath-progress {
        height: 100%;
        border-radius: 0.375rem;
        transition: width linear;
    }

    .breath-progress.inhale {
        background: #3b82f6;
    }

    .breath-progress.exhale {
        background: #10b981;
    }

    .breath-progress.gentle-breath {
        background: #06b6d4;
    }

    .breath-controls {
        display: grid;
        gap: 1rem;
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        margin: 1rem 0;
    }

    .breath-setting {
        text-align: center;
        padding: 1rem;
        background: #f8fafc;
        border-radius: 0.5rem;
        border: 1px solid #e2e8f0;
    }

    .breath-setting label {
        display: block;
        font-size: 0.875rem;
        color: var(--text-light);
        margin-bottom: 0.5rem;
    }

    .breath-setting input {
        width: 80px;
        text-align: center;
        font-size: 1.125rem;
        font-weight: bold;
        border: 1px solid #d1d5db;
        border-radius: 0.375rem;
        padding: 0.5rem;
        min-height: var(--touch-target);
    }

    /* Timer display */
    .timer-display {
        font-size: 2.5rem;
        font-weight: bold;
        text-align: center;
        color: var(--text-dark);
        margin: 1.5rem 0;
        font-family: 'Courier New', monospace;
    }

    /* Technique cards */
    .technique-card {
        background: linear-gradient(135deg, rgba(255,255,255,0.9), rgba(255,255,255,0.7));
        border: 1px solid rgba(102, 126, 234, 0.2);
        border-radius: 1rem;
        padding: 1.5rem;
        margin-bottom: 1rem;
        backdrop-filter: blur(10px);
        transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .technique-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(102, 126, 234, 0.15);
    }

    .technique-card h4 {
        color: #667eea;
        margin-bottom: 0.75rem;
        font-size: 1.1rem;
        font-weight: 600;
    }

    .technique-card p {
        font-size: 0.95rem;
        line-height: 1.6;
        color: #4b5563;
    }

    /* Step list styling */
    .step-list {
        list-style: none;
        margin: 1rem 0;
    }

    .step-list li {
        padding: 0.75rem 0;
        border-bottom: 1px solid #f3f4f6;
        font-size: 0.9rem;
    }

    .step-list li:before {
        content: "‚úì ";
        color: #10b981;
        font-weight: bold;
    }

    /* Entry cards for dagboek */
    .entry-card {
        background: white;
        border: 1px solid #e5e7eb;
        border-radius: 0.75rem;
        padding: 1rem;
        margin-bottom: 1rem;
        transition: var(--transition-base);
    }

    .entry-card:hover {
        transform: translateY(-1px);
        box-shadow: var(--shadow-sm);
    }

    .entry-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 0.75rem;
        gap: 1rem;
    }

    .entry-title {
        font-weight: 600;
        color: var(--text-dark);
        font-size: 0.95rem;
    }

    .entry-result {
        font-size: 0.8rem;
        font-weight: 500;
        white-space: nowrap;
    }

    .entry-result.zeer-goed { color: #059669; }
    .entry-result.goed { color: #10b981; }
    .entry-result.matig { color: #f59e0b; }
    .entry-result.geen-effect { color: var(--text-light); }
    .entry-result.slechter { color: #ef4444; }

    .intensity-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
        margin-bottom: 0.75rem;
    }

    /* Status indicators */
    .status-connected {
        background: #059669 !important;
        opacity: 0.8 !important;
    }

    .status-disconnected {
        background: #f59e0b !important;
        opacity: 0.6 !important;
    }

    .status-error {
        background: #ef4444 !important;
        opacity: 0.7 !important;
        animation: pulse 2s infinite;
    }

    @keyframes pulse {
        0%, 100% { opacity: 0.7; }
        50% { opacity: 1; }
    }

    /* Chart styling */
    .chart-container {
        position: relative;
        width: 100%;
        max-width: 100%;
        overflow: hidden;
    }

    .chart-legend {
        padding: 0.75rem;
        background: #f8fafc;
        border-radius: 0.5rem;
        border: 1px solid #e2e8f0;
    }

    /* Utility classes */
    .hidden {
        display: none !important;
    }

    .button-group {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        margin: 1rem 0;
    }

    .button-group .btn {
        flex: 1;
        min-width: 120px;
    }

    /* Responsive */
    @media (max-width: 768px) {
        .container {
            padding: 1rem;
        }
        
        .modal-content {
            margin: 1rem;
            padding: 1rem;
        }
        
        .btn {
            padding: 1rem;
            font-size: 0.9rem;
        }

        .nav-tabs {
            padding: 0.5rem 0.25rem;
            gap: 0.25rem;
        }

        .nav-tabs button {
            padding: 0.75rem 0.875rem;
            font-size: 0.75rem;
            min-width: 40px;
            border-radius: 0.875rem;
        }

        .user-info {
            top: 0.5rem;
            right: 0.5rem;
            font-size: 0.7rem;
            max-width: 100px;
            padding: 0.375rem 0.5rem;
        }

        .breath-display {
            font-size: 1.5rem;
            padding: 1rem;
            min-height: 80px;
        }

        .timer-display {
            font-size: 2rem;
        }

        /* Prevent zoom on input focus for iOS */
        .form-input, .form-select, .form-textarea {
            font-size: 16px;
        }
    }

    @media (max-width: 480px) {
        .nav-tabs button {
            font-size: 0.7rem;
            padding: 0.625rem 0.75rem;
        }

        .user-info {
            font-size: 0.65rem;
            max-width: 90px;
            padding: 0.25rem 0.375rem;
        }
    }

    @media (min-width: 768px) {
        .breath-controls {
            grid-template-columns: 1fr 1fr 1fr;
        }

        .breath-display {
            font-size: 2.5rem;
            padding: 2rem;
        }

        .timer-display {
            font-size: 3rem;
        }
    }
</style>
</head>

<body>
    <header role="banner">
        <div class="user-info" id="user-info" aria-live="polite">
            <div class="spinner" id="auth-loading" aria-label="Bezig met inloggen..."></div>
        </div>
        
        <!-- Ademruimte Logo -->
        <div class="logo-container">
            <svg viewBox="0 0 300 120" xmlns="http://www.w3.org/2000/svg" class="logo-svg">
              <defs>
                <radialGradient id="breathingGradient" cx="50%" cy="50%" r="50%">
                  <stop offset="0%" style="stop-color:#FFE0E6;stop-opacity:0.9"/>
                  <stop offset="50%" style="stop-color:#FF7F7F;stop-opacity:0.6"/>
                  <stop offset="100%" style="stop-color:#26A69A;stop-opacity:0.4"/>
                </radialGradient>
                
                <linearGradient id="textGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                  <stop offset="0%" style="stop-color:#FFFFFF"/>
                  <stop offset="50%" style="stop-color:#FFE0E6"/>
                  <stop offset="100%" style="stop-color:#FFFFFF"/>
                </linearGradient>
                
                <linearGradient id="flowGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                  <stop offset="0%" style="stop-color:#26A69A;stop-opacity:0.9"/>
                  <stop offset="50%" style="stop-color:#4DB6AC;stop-opacity:0.5"/>
                  <stop offset="100%" style="stop-color:#FF7F7F;stop-opacity:0.3"/>
                </linearGradient>
              </defs>
              
              <circle cx="60" cy="60" r="30" fill="none" stroke="rgba(255,255,255,0.7)" stroke-width="1.5" opacity="0.7">
                <animate attributeName="r" values="30;33;30" dur="8s" repeatCount="indefinite"/>
                <animate attributeName="opacity" values="0.5;0.8;0.5" dur="8s" repeatCount="indefinite"/>
              </circle>
              
              <circle cx="60" cy="60" r="20" fill="url(#breathingGradient)" opacity="0.8">
                <animate attributeName="r" values="20;22;20" dur="8s" repeatCount="indefinite"/>
                <animate attributeName="opacity" values="0.7;0.9;0.7" dur="8s" repeatCount="indefinite"/>
              </circle>
              
              <circle cx="60" cy="60" r="4" fill="#FF6B6B" opacity="1">
                <animate attributeName="r" values="4;6;4" dur="8s" repeatCount="indefinite"/>
                <animate attributeName="opacity" values="0.9;1;0.9" dur="8s" repeatCount="indefinite"/>
              </circle>
              
              <text x="140" y="45" font-family="Arial, sans-serif" font-size="28" font-weight="300" fill="url(#textGradient)">
                ademruimte
              </text>
              
              <text x="140" y="72" font-family="Arial, sans-serif" font-size="13" fill="rgba(255,255,255,0.9)" opacity="0.95">
                your safe breathing space
              </text>
            </svg>
        </div>
    </header>

    <!-- Login Screen -->
    <div id="login-screen" role="main">
        <div style="max-width: 400px; margin: 2rem auto; padding: 0 1rem;">
            <div class="card">
                <h2 style="text-align: center; margin-bottom: 1.5rem;">
                    Welkom bij Ademruimte
                </h2>
                
                <p style="text-align: center; margin-bottom: 2rem; color: var(--text-light);">
                    Log in om je vooruitgang op te slaan en te synchroniseren tussen al je apparaten.
                </p>

                <div class="alert alert-info" style="font-size: 0.8rem; margin-bottom: 1.5rem;">
                    <strong>üíª Browser ondersteuning:</strong> Deze app werkt het beste in moderne browsers (Chrome, Firefox, Safari, Edge). 
                    Zorg ervoor dat JavaScript en popups zijn ingeschakeld.
                </div>

                <!-- Google Login -->
                <button id="google-login-btn" class="google-btn" aria-label="Inloggen met Google account">
                    <svg width="18" height="18" viewBox="0 0 24 24">
                        <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                        <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                        <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                        <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                    </svg>
                    <span>Doorgaan met Google</span>
                </button>

                <div class="divider">
                    <span>of</span>
                </div>

                <!-- Email/Password Login -->
                <form id="login-form">
                    <div class="form-group">
                        <label for="login-email" class="form-label">E-mail:</label>
                        <input type="email" 
                               id="login-email" 
                               class="form-input" 
                               placeholder="jouw@email.com" 
                               required 
                               autocomplete="email">
                    </div>

                    <div class="form-group">
                        <label for="login-password" class="form-label">Wachtwoord:</label>
                        <input type="password" 
                               id="login-password" 
                               class="form-input" 
                               placeholder="Wachtwoord" 
                               required 
                               autocomplete="current-password">
                    </div>

                    <button type="submit" class="btn btn-primary" style="width: 100%; margin-bottom: 1rem;">
                        Inloggen
                    </button>
                </form>

                <div style="text-align: center;">
                    <p style="color: var(--text-light); font-size: 0.875rem; margin-bottom: 1rem;">
                        Nog geen account?
                    </p>
                    <button id="show-register-btn" class="btn btn-green" style="width: 100%;">
                        Account Aanmaken
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Register Modal -->
    <div id="register-modal" class="modal" role="dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Account Aanmaken</h3>
                <button class="close-btn" aria-label="Sluit registratie venster">&times;</button>
            </div>
            
            <form id="register-form">
                <div class="form-group">
                    <label for="register-name" class="form-label">Naam:</label>
                    <input type="text" 
                           id="register-name" 
                           class="form-input" 
                           placeholder="Jouw naam" 
                           required>
                </div>

                <div class="form-group">
                    <label for="register-email" class="form-label">E-mail:</label>
                    <input type="email" 
                           id="register-email" 
                           class="form-input" 
                           placeholder="jouw@email.com" 
                           required>
                </div>

                <div class="form-group">
                    <label for="register-password" class="form-label">Wachtwoord:</label>
                    <input type="password" 
                           id="register-password" 
                           class="form-input" 
                           placeholder="Minimaal 6 karakters" 
                           required 
                           minlength="6">
                </div>

                <div class="button-group">
                    <button type="submit" class="btn btn-green">
                        Account Aanmaken
                    </button>
                    <button type="button" class="btn" id="cancel-register-btn">
                        Annuleren
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Main App -->
    <div id="main-app" class="hidden">
        <nav class="nav-tabs" role="navigation">
            <button class="tab-btn active" data-tab="dashboard">üè† Dashboard</button>
            <button class="tab-btn" data-tab="crisis">üö® Crisis</button>
            <button class="tab-btn" data-tab="buteyko">üå¨Ô∏è Buteyko</button>
            <button class="tab-btn" data-tab="ritueel">üïê Ritueel</button>
            <button class="tab-btn" data-tab="gapen">ü•± Gapen</button>
            <button class="tab-btn" data-tab="emdr">üíú EMDR</button>
            <button class="tab-btn" data-tab="dagboek">üìñ Dagboek</button>
        </nav>

        <main class="container">
            <!-- Dashboard Tab -->
            <div id="dashboard" class="tab-content">
                <div class="card" style="text-align: center; padding: 2rem; margin-bottom: 2rem;">
                    <h2 id="dashboard-greeting">
                        Welkom bij Ademruimte
                    </h2>
                    <p style="color: var(--text-light); font-size: 1rem; margin-top: 0.5rem;">
                        Je persoonlijke ruimte voor ademhalingsoefeningen en hyperventilatie begeleiding.
                    </p>
                </div>

                <div class="grid">
                    <div class="card">
                        <h3>üö® Crisis Hulp</h3>
                        <p>Voor wanneer je luchthonger voelt opkomen</p>
                        <button class="btn btn-red" onclick="showTab('crisis')">Open Crisis Hulp</button>
                    </div>

                    <div class="card">
                        <h3>üå¨Ô∏è Buteyko Ademhaling</h3>
                        <p>CO2 tolerantie training</p>
                        <button class="btn btn-cyan" onclick="showTab('buteyko')">Start Buteyko</button>
                    </div>

                    <div class="card">
                        <h3>üïê Afkoel Ritueel</h3>
                        <p>Na intensief denkwerk</p>
                        <button class="btn btn-green" onclick="showTab('ritueel')">Start Ritueel</button>
                    </div>

                    <div class="card">
                        <h3>ü•± Gaap Preventie</h3>
                        <p>Technieken voor gaapaanvallen</p>
                        <button class="btn btn-orange" onclick="showTab('gapen')">Bekijk Technieken</button>
                    </div>

                    <div class="card">
                        <h3>üíú EMDR Zelfhulp</h3>
                        <p>Voor luchthonger-gevoelens</p>
                        <button class="btn btn-purple" onclick="showTab('emdr')">Start EMDR</button>
                    </div>

                    <div class="card">
                        <h3>üìñ Dagboek</h3>
                        <p>Bijhouden van patronen</p>
                        <button class="btn btn-primary" onclick="showTab('dagboek')">Open Dagboek</button>
                    </div>
                </div>

                <div class="alert alert-info">
                    <strong>üí° Tip van de dag:</strong> 
                    <span id="daily-tip">Gaapaanvallen zijn een waarschuwingssignaal, geen bedreiging. Gebruik ze als mogelijkheid om preventief in te grijpen.</span>
                    <button id="tip-refresh-btn" 
                            style="background: none; border: none; color: #0891b2; cursor: pointer; margin-left: 0.5rem; font-weight: 600;">üîÑ</button>
                </div>

                <div class="card">
                    <h3>üë§ Account</h3>
                    <div id="account-info" style="margin-bottom: 1rem;">
                        <!-- Account info wordt hier ingevuld -->
                    </div>
                    <button class="btn btn-red" onclick="performLogout()">
                        üö™ Uitloggen
                    </button>
                </div>
            </div>

            <!-- Crisis Tab -->
            <div id="crisis" class="tab-content hidden">
                <div class="card">
                    <h2>üö® Crisis Hulp - Luchthonger</h2>
                    <p>Voor wanneer je dat benauwde gevoel voelt opkomen</p>
                </div>

                <div class="technique-card">
                    <h4>1. Paradoxale Ademhaling</h4>
                    <p>Start met bewust zeer kleine, korte ademhalingen. Na 3-4 van deze mini-ademhalingen, probeer een iets langere uitademing.</p>
                </div>

                <div class="technique-card">
                    <h4>2. Purse-lip Ademhaling</h4>
                    <p>Tuut je lippen bij het uitademen om lichte weerstand te cre√´ren. Dit helpt bij luchthonger en stabiliseert CO2-niveaus.</p>
                </div>

                <div class="technique-card">
                    <h4>3. IJswater Techniek</h4>
                    <p>Breng iets kouds tegen je gezicht (vooral rond wangen en ogen) om de duikreflex te activeren.</p>
                </div>

                <div class="technique-card">
                    <h4>4. Herframing</h4>
                    <p>"Dit is geen echt zuurstoftekort, dit is een sensatie die voorbij zal gaan. Mijn lichaam krijgt genoeg zuurstof."</p>
                </div>

                <div class="card">
                    <h3>5-4-3-2-1 Grounding</h3>
                    <ul class="step-list">
                        <li>5 dingen die je ZIET</li>
                        <li>4 dingen die je VOELT</li>
                        <li>3 dingen die je HOORT</li>
                        <li>2 dingen die je RUIKT</li>
                        <li>1 ding dat je PROEFT</li>
                    </ul>
                </div>

                <div class="card">
                    <button class="btn btn-primary" onclick="openDagboekModal('Crisis Hulp Technieken')">
                        üìù Dagboek Entry Maken
                    </button>
                </div>
            </div>

            <!-- Buteyko Tab -->
            <div id="buteyko" class="tab-content hidden">
                <div class="card">
                    <h2>üå¨Ô∏è Buteyko Ademhaling</h2>
                    <p>Verbeter je CO2 tolerantie en verminder hyperventilatie neiging</p>
                </div>

                <div class="alert alert-info">
                    <strong>üí° Hoe het werkt:</strong> Buteyko ademhaling helpt je lichaam wennen aan hogere CO2 niveaus, wat hyperventilatie-episodes kan verminderen.
                </div>

                <div class="card">
                    <h3>Ademhalingsinstellingen</h3>
                    <div style="margin-bottom: 1rem;">
                        <label style="font-weight: 500; margin-bottom: 0.5rem; display: block;">Ademhalingspatroon:</label>
                        <select id="breathing-pattern" class="form-select" onchange="updateBreathingPattern()">
                            <option value="standard">Standaard (4-6-3)</option>
                            <option value="gentle">Zacht (2x ademhaling + pauze)</option>
                        </select>
                    </div>
                    
                    <div id="standard-controls" class="breath-controls">
                        <div class="breath-setting">
                            <label>Inademen (sec)</label>
                            <input type="number" id="inhale-duration" value="4" min="2" max="10">
                        </div>
                        <div class="breath-setting">
                            <label>Uitademen (sec)</label>
                            <input type="number" id="exhale-duration" value="6" min="3" max="15">
                        </div>
                        <div class="breath-setting">
                            <label>Pauze (sec)</label>
                            <input type="number" id="hold-duration" value="3" min="1" max="20">
                        </div>
                    </div>

                    <div id="gentle-controls" class="breath-controls hidden">
                        <div class="breath-setting">
                            <label>Cyclus Tijd (sec)</label>
                            <input type="number" id="gentle-cycle" value="10" min="8" max="15" readonly>
                        </div>
                        <div class="breath-setting">
                            <label>Pauze (sec)</label>
                            <input type="number" id="gentle-pause" value="4" min="2" max="8">
                        </div>
                        <div class="breath-setting">
                            <label>Ademhalingen</label>
                            <div style="font-weight: bold; color: #3b82f6; margin-top: 0.5rem;">2x per cyclus</div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="breath-display rest" id="breath-display">
                        Klik op start om te beginnen
                    </div>

                    <div class="progress-bar">
                        <div class="breath-progress" id="breath-progress" style="width: 0%"></div>
                    </div>

                    <div style="text-align: center; margin: 1rem 0;">
                        <div id="breath-cycle-counter" style="font-size: 1.125rem; color: var(--text-light); margin-bottom: 1rem;">
                            Cyclus: 1/10
                        </div>
                        
                        <div class="button-group">
                            <button id="breath-btn" class="btn btn-cyan" onclick="toggleBreathExercise()">
                                ‚ñ∂Ô∏è Start Buteyko
                            </button>
                            <button class="btn btn-orange" onclick="resetBreathExercise()">
                                üîÑ Reset
                            </button>
                        </div>
                    </div>
                </div>

                <div id="breath-complete" class="alert alert-success hidden">
                    <strong>‚úÖ Buteyko Sessie Voltooid!</strong><br>
                    Geweldig! Je hebt 10 ademhalingscycli succesvol afgerond.
                    <br><br>
                    <div class="button-group">
                        <button class="btn btn-primary" onclick="openDagboekModal('Buteyko Ademhaling - 10 Cycli Voltooid')">
                            üìù Maak Dagboek Entry
                        </button>
                        <button class="btn btn-orange" onclick="skipButeykoDagboek()">
                            ‚è≠Ô∏è Overslaan
                        </button>
                    </div>
                </div>

                <div class="card">
                    <h3>Buteyko Principes</h3>
                    <div class="technique-card">
                        <h4>Zachte Ademhaling</h4>
                        <p>Adem zo zacht mogelijk - stel je voor dat je een veertje voor je neus niet wilt laten bewegen.</p>
                    </div>
                    <div class="technique-card">
                        <h4>Langere Uitademing</h4>
                        <p>De uitademing is langer dan de inademing om CO2 te behouden en het autonome zenuwstelsel te kalmeren.</p>
                    </div>
                    <div class="technique-card">
                        <h4>Comfortabele Pauze</h4>
                        <p>De adempauze na uitademing mag nooit geforceerd aanvoelen - stop als het oncomfortabel wordt.</p>
                    </div>
                </div>
            </div>

            <!-- Ritueel Tab -->
            <div id="ritueel" class="tab-content hidden">
                <div class="card">
                    <h2>üïê Afkoel Ritueel</h2>
                    <p>Voor na periodes van intensief denkwerk (5-10 minuten)</p>
                </div>

                <div class="card">
                    <h3 id="ritual-title">Stap 1: Fysieke Mini-Reset</h3>
                    <div class="timer-display" id="timer-display">2:00</div>
                    
                    <div id="ritual-instructions">
                        <ul class="step-list">
                            <li>Sta op en strek je volledig uit</li>
                            <li>Schud je armen en benen los</li>
                            <li>Rol je schouders 5x naar achteren</li>
                            <li>Maak kleine cirkels met je hoofd (5x elke richting)</li>
                        </ul>
                    </div>

                    <div class="button-group">
                        <button id="timer-btn" class="btn btn-green" onclick="startTimer()">‚ñ∂Ô∏è Start Timer</button>
                        <button class="btn btn-primary" onclick="nextRitualStep()" id="next-btn" style="display: none;">Volgende Stap</button>
                        <button class="btn btn-cyan" onclick="skipToNextStep()" id="skip-btn">‚è≠Ô∏è Overslaan</button>
                        <button class="btn btn-orange" onclick="resetRitual()">üîÑ Reset</button>
                    </div>

                    <div class="progress-bar">
                        <div class="progress-fill" id="ritual-progress" style="width: 20%"></div>
                    </div>

                    <div id="ritual-complete" class="alert alert-success hidden">
                        <strong>‚úÖ Afkoel Ritueel Voltooid!</strong><br>
                        Fantastisch! Je hebt alle 5 stappen van het afkoel ritueel doorlopen.
                        <br><br>
                        <div class="button-group">
                            <button class="btn btn-primary" onclick="openDagboekModal('Afkoel Ritueel - 5 Stappen Voltooid')">
                                üìù Maak Dagboek Entry
                            </button>
                            <button class="btn btn-orange" onclick="skipRitualDagboek()">
                                ‚è≠Ô∏è Overslaan
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Gapen Tab -->
            <div id="gapen" class="tab-content hidden">
                <div class="card">
                    <h2>ü•± Gaap Preventie Technieken</h2>
                    <p>Voor wanneer je die vervelende gaapaanvallen voelt opkomen</p>
                </div>

                <div class="technique-card">
                    <h4>Lipremming-techniek</h4>
                    <p>Druk je lippen zachtjes op elkaar wanneer je een gaapneiging voelt. Laat de lucht langzaam door je neus in en uit gaan.</p>
                </div>

                <div class="technique-card">
                    <h4>Mini-ademhalingen</h4>
                    <p>Neem bewust 3-4 zeer kleine, ondiepe ademhalingen door je neus. Hiermee voorkom je de grote 'zucht-ademhaling'.</p>
                </div>

                <div class="technique-card">
                    <h4>Tongpositie veranderen</h4>
                    <p>Plaats je tongpunt tegen je gehemelte (achter je voortanden). Dit vermindert de neiging tot gapen.</p>
                </div>

                <div class="technique-card">
                    <h4>Water drinken</h4>
                    <p>Neem kleine slokjes water wanneer je merkt dat je begint te gapen. Dit doorbreekt het ademhalingspatroon.</p>
                </div>

                <div class="alert alert-info">
                    <strong>üí° Belangrijk om te onthouden:</strong> Gaapaanvallen zijn een waarschuwingssignaal, geen bedreiging. Ze geven je de kans om preventief in te grijpen voordat een volledige hyperventilatie-episode begint.
                </div>

                <div class="card">
                    <h3>Gedachte-Breaking Technieken</h3>
                    <div class="technique-card">
                        <strong>Paradoxale intentie:</strong> "Ok√© hersenen, jullie willen dat ik ga gapen? Prima, ik ga nu heel bewust gapen"
                    </div>
                    <div class="technique-card">
                        <strong>Herframing:</strong> "Mijn brein probeert me te beschermen, maar ik hoef niet te reageren"
                    </div>
                    <div class="technique-card">
                        <strong>Aandacht verplaatsen:</strong> Tel 5 blauwe dingen die je kunt zien
                    </div>
                </div>

                <div class="card">
                    <button class="btn btn-primary" onclick="openDagboekModal('Gaap Preventie Technieken')">
                        üìù Dagboek Entry Maken
                    </button>
                </div>
            </div>

            <!-- EMDR Tab -->
            <div id="emdr" class="tab-content hidden">
                <div class="card">
                    <h2>üíú EMDR Zelfhulp</h2>
                    <p>Voor luchthonger-gevoelens (dit is ondersteuning, geen vervanging voor professionele EMDR)</p>
                </div>

                <div class="alert alert-warning">
                    <strong>‚ö†Ô∏è Gebruik dit alleen voor milde tot matige gevoelens. Stop als je je overweldigd voelt.</strong>
                </div>

                <div class="alert alert-info">
                    <strong>üéß Bilaterale Audio:</strong> Voor de beste ervaring, gebruik koptelefoon of oortjes. Zet het volume op een comfortabel niveau voordat je begint.
                </div>

                <!-- Audio Controls -->
                <div class="card">
                    <h3>üîä Bilaterale Audio Stimulatie</h3>
                    <p style="margin-bottom: 1rem;">Een instelbare toon die van links naar rechts beweegt om bilaterale hersenstimulatie te ondersteunen.</p>
                    
                    <div class="breath-controls">
                        <div class="breath-setting">
                            <label>Volume (%)</label>
                            <input type="number" id="audio-volume" value="30" min="10" max="100" step="10">
                        </div>
                        <div class="breath-setting">
                            <label>Snelheid (sec)</label>
                            <input type="number" id="audio-speed" value="2" min="1" max="5" step="0.5">
                        </div>
                        <div class="breath-setting">
                            <label>Toonhoogte (Hz)</label>
                            <input type="number" id="audio-frequency" value="880" min="60" max="1000" step="10">
                            <div style="font-size: 0.7rem; color: var(--text-light); margin-top: 0.25rem;">60-1000 Hz</div>
                        </div>
                        <div class="breath-setting">
                            <label>Status</label>
                            <div id="audio-status" style="font-weight: bold; color: var(--text-light); margin-top: 0.5rem;">Gestopt</div>
                        </div>
                    </div>

                    <div class="button-group">
                        <button id="audio-btn" class="btn btn-purple" onclick="toggleBilateralAudio()">
                            üîä Start Audio
                        </button>
                    </div>
                </div>

                <div class="card">
                    <h3 id="emdr-title">Stap 1: Voorbereiding</h3>
                    <div id="emdr-content">
                        <p>Zorg dat je in een veilige, rustige ruimte bent. Heb water binnen handbereik. Stop als het te overweldigend wordt.</p>
                    </div>

                    <div id="emdr-intensity" class="hidden">
                        <div class="form-group">
                            <label class="form-label">Intensiteit van luchthonger-gevoel (1-10):</label>
                            <input type="range" min="1" max="10" value="5" class="range-input" id="emdr-intensity-slider">
                            <div class="range-value" id="emdr-intensity-value">5</div>
                        </div>
                    </div>

                    <div class="button-group">
                        <button id="emdr-prev-btn" class="btn btn-orange" onclick="prevEmdrStep()" style="display: none;">Vorige</button>
                        <button id="emdr-next-btn" class="btn btn-purple" onclick="nextEmdrStep()">Volgende</button>
                    </div>

                    <div class="progress-bar">
                        <div class="progress-fill" id="emdr-progress" style="width: 20%"></div>
                    </div>

                    <div id="emdr-complete" class="alert alert-success hidden">
                        <strong>‚úÖ EMDR Zelfhulp Sessie Voltooid!</strong><br>
                        Goed gedaan! Je hebt alle 5 stappen van de EMDR zelfhulp doorlopen.
                        <br><br>
                        <div class="button-group">
                            <button class="btn btn-primary" onclick="openDagboekModal('EMDR Zelfhulp - 5 Stappen Voltooid')">
                                üìù Maak Dagboek Entry
                            </button>
                            <button class="btn btn-orange" onclick="skipEmdrDagboek()">
                                ‚è≠Ô∏è Overslaan
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Dagboek Tab -->
            <div id="dagboek" class="tab-content hidden">
                <div class="card">
                    <h2>üìñ Dagboek</h2>
                    <p>Overzicht van je sessies en vooruitgang</p>
                    <div class="button-group">
                        <button class="btn btn-primary" onclick="openDagboekModal('Handmatige Entry')">
                            ‚ûï Nieuwe Entry
                        </button>
                        <button class="btn btn-green" onclick="loadDagboekEntries()">
                            üîÑ Vernieuw
                        </button>
                        <button class="btn btn-orange" onclick="exportDagboek()">
                            üì• Export Dagboek
                        </button>
                    </div>
                </div>

                <!-- Vooruitgang Grafiek -->
                <div class="card">
                    <h3>üìä Je Vooruitgang</h3>
                    <p style="color: var(--text-light); margin-bottom: 1rem;">Intensiteit scores over tijd - lagere scores betekenen meer verbetering</p>
                    
                    <div class="chart-container" style="position: relative; height: 300px; margin: 1rem 0;">
                        <canvas id="progress-chart" style="max-height: 300px;"></canvas>
                    </div>
                    
                    <div id="chart-legend" class="chart-legend" style="display: none; margin-top: 1rem;">
                        <div style="display: flex; justify-content: center; gap: 1rem; flex-wrap: wrap; font-size: 0.85rem;">
                            <div style="display: flex; align-items: center; gap: 0.25rem;">
                                <div style="width: 12px; height: 12px; background: #ef4444; border-radius: 2px;"></div>
                                <span>V√≥√≥r oefening</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 0.25rem;">
                                <div style="width: 12px; height: 12px; background: #10b981; border-radius: 2px;"></div>
                                <span>N√° oefening</span>
                            </div>
                        </div>
                    </div>
                    
                    <div id="chart-empty" class="alert alert-info" style="text-align: center;">
                        <strong>üìà Geen data beschikbaar</strong><br>
                        Maak een paar dagboek entries om je vooruitgang te zien!
                    </div>
                </div>

                <div id="dagboek-entries">
                    <!-- Entries worden hier geladen -->
                </div>

                <div class="card">
                    <h3>Patronen om naar uit te kijken</h3>
                    <ul class="step-list">
                        <li>Welke technieken het beste werken voor jou</li>
                        <li>Tijdstippen waarop klachten vaker voorkomen</li>
                        <li>Specifieke triggers (werk, stress, bepaalde gedachten)</li>
                        <li>Verband tussen maagklachten en ademhalingsproblemen</li>
                        <li>Verbetering in intensiteit scores over tijd</li>
                    </ul>
                </div>
            </div>
        </main>
    </div>

    <!-- Dagboek Modal -->
    <div id="dagboek-modal" class="modal" role="dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üìù Dagboek Entry</h3>
                <button class="close-btn" onclick="closeDagboekModal()">&times;</button>
            </div>
            
            <form id="dagboek-form">
                <div class="form-group">
                    <label class="form-label" for="entry-trigger">Situatie/Trigger:</label>
                    <input type="text" id="entry-trigger" class="form-input" placeholder="Bijv. na intensief werken">
                </div>

                <div class="grid">
                    <div class="form-group">
                        <label class="form-label" for="entry-before">Intensiteit v√≥√≥r oefening (1-10):</label>
                        <input type="range" min="1" max="10" value="5" class="range-input" id="entry-before">
                        <div class="range-value" id="entry-before-value">5</div>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="entry-after">Intensiteit n√° oefening (1-10):</label>
                        <input type="range" min="1" max="10" value="5" class="range-input" id="entry-after">
                        <div class="range-value" id="entry-after-value">5</div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label" for="entry-result">Resultaat:</label>
                    <select id="entry-result" class="form-select">
                        <option value="">Selecteer resultaat...</option>
                        <option value="zeer-goed">Zeer goed - volledig opgelost</option>
                        <option value="goed">Goed - duidelijke verbetering</option>
                        <option value="matig">Matig - kleine verbetering</option>
                        <option value="geen-effect">Geen effect</option>
                        <option value="slechter">Iets slechter</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label" for="entry-notes">Notities:</label>
                    <textarea id="entry-notes" class="form-textarea" placeholder="Wat viel je op?"></textarea>
                </div>

                <div class="button-group">
                    <button type="button" class="btn btn-primary" id="save-dagboek-entry-btn">
                        üìÅ Opslaan
                    </button>
                    <button type="button" class="btn btn-orange" onclick="closeDagboekModal()">
                        Annuleren
                    </button>
                </div>
            </form>
        </div>
    </div>

    <footer style="text-align: center; padding: 2rem 1rem; color: var(--text-light); font-size: 0.8rem;">
        <div style="display: flex; align-items: center; justify-content: center; gap: 0.75rem; margin-bottom: 1rem; flex-wrap: wrap;">
            <p style="margin: 0;">üìû In noodgevallen: contacteer altijd je huisarts of spoeddiensten</p>
            
            <!-- Firebase Status Indicator -->
            <div style="display: flex; align-items: center; gap: 0.375rem;">
                <div id="firebase-status-dot" class="status-disconnected" style="width: 8px; height: 8px; border-radius: 50%; background: #f59e0b; transition: all 0.3s ease; opacity: 0.6;" title="Firebase verbinding status"></div>
                <span style="font-size: 0.7rem; opacity: 0.7;">Status</span>
            </div>
        </div>
        
        <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid rgba(255,255,255,0.1);">
            <p style="margin: 0; font-size: 0.75rem; opacity: 0.8; color: rgba(255,255,255,0.9);">
                Ontwikkeld door <strong>Thomas Van Troostenberghe</strong>
            </p>
        </div>
    </footer>

<script type="module">
    // Enable detailed logging
    console.log('üöÄ Ademruimte App Starting...');
    
    // Firebase configuration
    const firebaseConfig = {
        apiKey: "AIzaSyBwDkmbKOzZAyIZW7-ud4qYr7xHyILCdzI",
        authDomain: "ademruimte-12c09.firebaseapp.com", 
        projectId: "ademruimte-12c09",
        storageBucket: "ademruimte-12c09.firebasestorage.app",
        messagingSenderId: "744941871331",
        appId: "1:744941871331:web:c3ce24d814fe41314d25d6",
        measurementId: "G-SD2ZEYNMNY"
    };

    // Global variables
    let app, db, auth;
    let currentUser = null;
    let isFirebaseConnected = false;
    let authInitialized = false;
    let currentTab = 'dashboard';
    let currentTechnique = '';
    
    // Exercise variables
    let breathInterval = null;
    let breathPhase = 'rest';
    let breathCycleCount = 1;
    let breathPhaseTime = 0;
    let breathCycleDuration = 0;
    let breathingPattern = 'standard';
    let gentleBreathCount = 0;
    
    let timerInterval = null;
    let currentTime = 0;
    let ritualStep = 0;
    let emdrStep = 0;

    // Audio variables for EMDR
    let audioContext = null;
    let oscillator = null;
    let gainNode = null;
    let pannerNode = null;
    let audioInterval = null;
    let isAudioPlaying = false;
    let panPosition = -1;

    // Progress chart
    let progressChart = null;

    // Tips array
    const tips = [
        "Gaapaanvallen zijn een waarschuwingssignaal, geen bedreiging. Gebruik ze als mogelijkheid om preventief in te grijpen.",
        "Bij luchthonger: probeer paradoxale ademhaling - begin met zeer kleine, korte ademhalingen.",
        "CO2 is niet giftig! Een hoger CO2-niveau in je bloed is juist gezond en kalmerend.",
        "Buteyko ademhaling helpt je lichaam wennen aan hogere CO2 niveaus.",
        "Een koude kompres op je gezicht activeert de duikreflex en kalmeert het zenuwstelsel.",
        "Grounding technieken zoals 5-4-3-2-1 helpen je geest terug naar het hier en nu te brengen.",
        "Zachte ademhaling is effectiever dan diepe ademhaling bij hyperventilatie.",
        "Regelmatige oefening van ademhalingstechnieken vermindert de kans op episodes.",
        "Het bijhouden van patronen in je dagboek helpt je triggers te identificeren.",
        "Na intensief denkwerk heeft je lichaam een afkoel ritueel nodig om te ontspannen."
    ];

    // Ritual steps data
    const ritualSteps = [
        {
            title: "Stap 1: Fysieke Mini-Reset",
            duration: 120,
            instructions: [
                "Sta op en strek je volledig uit",
                "Schud je armen en benen los", 
                "Rol je schouders 5x naar achteren",
                "Maak kleine cirkels met je hoofd (5x elke richting)"
            ]
        },
        {
            title: "Stap 2: Ademhaling Reset",
            duration: 90,
            instructions: [
                "Ga comfortabel zitten of staan",
                "Adem 5x heel diep in door je neus",
                "Adem langzaam uit door je mond",
                "Let op de vertraging tussen gedachte en lichaam"
            ]
        },
        {
            title: "Stap 3: Mentale Overgang",
            duration: 120,
            instructions: [
                "Zeg hardop: 'Ik ben klaar met intensief denken'",
                "Denk aan 3 dingen waar je dankbaar voor bent",
                "Visualiseer je volgende activiteit",
                "Geef jezelf toestemming om te ontspannen"
            ]
        },
        {
            title: "Stap 4: Zintuiglijke Reset",
            duration: 90,
            instructions: [
                "Kijk bewust rond - wat zie je?",
                "Luister naar geluiden om je heen",
                "Voel de temperatuur op je huid",
                "Ruik bewust de lucht om je heen"
            ]
        },
        {
            title: "Stap 5: Intentie Zetten",
            duration: 60,
            instructions: [
                "Besluit bewust hoe je je volgende tijd wilt besteden",
                "Zeg tegen jezelf: 'Ik ga nu over naar [activiteit]'",
                "Neem √©√©n bewuste stap in die richting",
                "Feliciteer jezelf - je hebt een goede overgang gemaakt"
            ]
        }
    ];

    // EMDR Steps
    const emdrSteps = [
        {
            title: "Stap 1: Voorbereiding",
            content: "Zorg dat je in een veilige, rustige ruimte bent. Heb water binnen handbereik. Stop als het te overweldigend wordt.",
            showIntensity: false
        },
        {
            title: "Stap 2: Identificeer het Gevoel",
            content: "Denk aan het luchthonger-gevoel. Waar voel je het in je lichaam? Geef het een intensiteit score van 1-10.",
            showIntensity: true
        },
        {
            title: "Stap 3: Bilaterale Stimulatie",
            content: "Start de bilaterale audio als je dit nog niet hebt gedaan. Focus op het gevoel terwijl je naar de bewegende toon luistert. Laat gedachten en gevoelens vrijelijk komen en gaan.",
            showIntensity: false
        },
        {
            title: "Stap 4: Check-in",
            content: "Stop de audio. Hoe voelt het luchthonger-gevoel nu? Is de intensiteit veranderd? Geef een nieuwe score van 1-10.",
            showIntensity: true
        },
        {
            title: "Stap 5: Afsluiting",
            content: "Neem een paar diepe, langzame ademhalingen. Visualiseer een veilige, kalme plek. Je hebt goed werk gedaan. Drink wat water als je dat nodig hebt.",
            showIntensity: false
        }
    ];

    // Utility functions
    function log(level, message, data = null) {
        const timestamp = new Date().toLocaleTimeString('nl-NL');
        const emoji = {
            'INFO': '‚ÑπÔ∏è',
            'SUCCESS': '‚úÖ', 
            'WARNING': '‚ö†Ô∏è',
            'ERROR': '‚ùå'
        };
        console.log(`${emoji[level] || 'üìù'} [${timestamp}] ${message}`, data || '');
    }

    function showUserMessage(message, type = 'info') {
        // Remove existing message
        const existing = document.querySelector('.user-message');
        if (existing) existing.remove();
        
        const messageEl = document.createElement('div');
        messageEl.className = `user-message alert-${type}`;
        messageEl.textContent = message;
        
        document.body.appendChild(messageEl);
        
        // Auto-remove
        setTimeout(() => {
            if (messageEl.parentNode) {
                messageEl.remove();
            }
        }, type === 'error' ? 8000 : 5000);
    }

    function updateConnectionStatus(connected) {
        isFirebaseConnected = connected;
        const statusDot = document.getElementById('firebase-status-dot');
        if (statusDot) {
            if (connected) {
                statusDot.className = 'status-connected';
                statusDot.title = 'Firebase: Verbonden';
            } else {
                statusDot.className = 'status-disconnected';
                statusDot.title = 'Firebase: Niet verbonden';
            }
        }
    }

    function updateUserInfo() {
        const userInfo = document.getElementById('user-info');
        const accountInfo = document.getElementById('account-info');
        const authLoading = document.getElementById('auth-loading');
        
        // Hide loading spinner
        if (authLoading) {
            authLoading.style.display = 'none';
        }

        if (currentUser && userInfo) {
            const displayName = currentUser.displayName || currentUser.email;
            const shortName = displayName.length > 15 ? displayName.substring(0, 13) + '...' : displayName;
            userInfo.innerHTML = shortName;
        } else if (userInfo) {
            userInfo.innerHTML = '';
        }

        if (currentUser && accountInfo) {
            accountInfo.innerHTML = 
                '<p style="color: var(--text-light); font-size: 0.9rem;">' +
                '<strong>Ingelogd als:</strong><br>' + 
                (currentUser.displayName || currentUser.email) + 
                '</p>';
        } else if (accountInfo) {
            accountInfo.innerHTML = '<p style="color: var(--text-light); font-size: 0.9rem;">Niet ingelogd</p>';
        }
        
        updateDashboardGreeting();
    }

    function updateDashboardGreeting() {
        const greetingElement = document.getElementById('dashboard-greeting');
        if (greetingElement && currentUser) {
            const firstName = getFirstName();
            const timeOfDay = getTimeOfDay();
            greetingElement.textContent = `${timeOfDay}, ${firstName}!`;
        } else if (greetingElement) {
            greetingElement.textContent = `Welkom bij Ademruimte`;
        }
    }

    function getFirstName() {
        if (!currentUser) return 'Gebruiker';
        
        const displayName = currentUser.displayName;
        if (displayName) {
            return displayName.split(' ')[0];
        }
        
        const email = currentUser.email;
        if (email) {
            const localPart = email.split('@')[0];
            return localPart.charAt(0).toUpperCase() + localPart.slice(1);
        }
        
        return 'Gebruiker';
    }

    function getTimeOfDay() {
        const hour = new Date().getHours();
        if (hour < 12) return 'Goedemorgen';
        if (hour < 18) return 'Goedemiddag';
        return 'Goedenavond';
    }

    function showLoginScreen() {
        document.getElementById('login-screen').classList.remove('hidden');
        document.getElementById('main-app').classList.add('hidden');
        log('INFO', 'Switched to login screen');
    }

    function showMainApp() {
        document.getElementById('login-screen').classList.add('hidden');
        document.getElementById('main-app').classList.remove('hidden');
        setTimeout(() => updateDashboardGreeting(), 100);
        log('INFO', 'Switched to main app');
    }

    // Firebase initialization with enhanced error handling
    async function initializeFirebase() {
        if (authInitialized) {
            console.log('‚úÖ Firebase already initialized');
            return true;
        }
        
        try {
            console.log('üî• Starting Firebase initialization...');
            console.log('üìä Config check:', {
                apiKey: firebaseConfig.apiKey ? 'Present' : 'Missing',
                authDomain: firebaseConfig.authDomain,
                projectId: firebaseConfig.projectId
            });
            
            // Test network connectivity first
            if (!navigator.onLine) {
                throw new Error('No internet connection available');
            }
            
            // Test if we can access Firebase modules with timeout
            console.log('üì¶ Loading Firebase modules...');
            const modulePromise = Promise.all([
                import("https://www.gstatic.com/firebasejs/10.13.2/firebase-app.js"),
                import("https://www.gstatic.com/firebasejs/10.13.2/firebase-firestore.js"),
                import("https://www.gstatic.com/firebasejs/10.13.2/firebase-auth.js")
            ]);
            
            const timeoutPromise = new Promise((_, reject) => 
                setTimeout(() => reject(new Error('Firebase modules loading timeout')), 15000)
            );
            
            const [appModule, firestoreModule, authModule] = await Promise.race([modulePromise, timeoutPromise]);
            
            const { initializeApp } = appModule;
            const { getFirestore } = firestoreModule;
            const { getAuth, onAuthStateChanged, GoogleAuthProvider, signInWithPopup, signInWithEmailAndPassword, createUserWithEmailAndPassword, updateProfile, signOut } = authModule;
            
            console.log('‚úÖ Firebase modules loaded successfully');

            // Initialize Firebase with error catching
            console.log('üîß Initializing Firebase app...');
            app = initializeApp(firebaseConfig);
            console.log('‚úÖ Firebase app initialized:', app.name);
            
            auth = getAuth(app);
            console.log('‚úÖ Auth initialized, state:', auth.currentUser ? 'Has user' : 'No user');
            
            db = getFirestore(app);
            console.log('‚úÖ Firestore initialized');

            // Set up auth state observer with enhanced error handling
            console.log('üëÅÔ∏è Setting up auth state observer...');
            const unsubscribe = onAuthStateChanged(auth, 
                (user) => {
                    console.log('üîî Auth state changed:', user ? `User: ${user.email} (${user.uid})` : 'No user');
                    currentUser = user;
                    updateUserInfo();
                    
                    if (user) {
                        console.log('‚úÖ User authenticated, showing main app');
                        showMainApp();
                        
                        // Load user data after UI is ready
                        setTimeout(() => {
                            if (currentTab === 'dagboek') {
                                loadDagboekEntries().catch(error => {
                                    log('WARNING', 'Could not load entries on login:', error);
                                });
                            }
                        }, 500);
                    } else {
                        console.log('‚ùå No user, showing login screen');
                        showLoginScreen();
                    }
                }, 
                (error) => {
                    console.error('‚ùå Auth state observer error:', error);
                    updateUserInfo(); // Hide spinner
                    showUserMessage('Authenticatie fout: ' + error.message, 'error');
                    showLoginScreen();
                }
            );

            // Store unsubscribe function for cleanup
            window.authUnsubscribe = unsubscribe;

            updateConnectionStatus(true);
            authInitialized = true;
            console.log('üéâ Firebase initialization completed successfully');
            
            // Test auth readiness
            console.log('üß™ Testing auth readiness...');
            console.log('Auth currentUser:', auth.currentUser);
            console.log('Auth ready state:', auth.authStateReady ? 'Ready' : 'Not ready');
            
            return true;

        } catch (error) {
            console.error('üí• Firebase initialization failed:', error);
            console.error('Error details:', {
                name: error.name,
                message: error.message,
                code: error.code || 'No code',
                stack: error.stack
            });
            
            updateConnectionStatus(false);
            authInitialized = false;
            
            let userMessage = 'Firebase kon niet worden ge√Ønitialiseerd.';
            if (error.message.includes('timeout')) {
                userMessage += ' Netwerkverbinding te traag.';
            } else if (error.message.includes('No internet')) {
                userMessage += ' Geen internetverbinding.';
            } else {
                userMessage += ' Check de console voor details.';
            }
            
            showUserMessage(userMessage, 'error');
            showLoginScreen();
            return false;
        }
    }

    // Enhanced Google Sign-In with better error handling
    window.signInWithGoogle = async function() {
        console.log('üîµ Google sign-in button clicked');
        const googleBtn = document.getElementById('google-login-btn');
        const originalText = googleBtn.textContent;
        
        // Immediate UI feedback
        googleBtn.textContent = 'Bezig...';
        googleBtn.disabled = true;

        try {
            // Ensure Firebase is initialized
            if (!authInitialized || !auth) {
                console.log('‚ö†Ô∏è Firebase not initialized, initializing now...');
                const initialized = await initializeFirebase();
                if (!initialized) {
                    throw new Error('Firebase initialization failed');
                }
            }

            // Verify auth object is ready
            if (!auth || typeof auth.signInWithPopup !== 'function') {
                console.log('‚ö†Ô∏è Auth object not ready, waiting...');
                await new Promise(resolve => setTimeout(resolve, 1000));
                if (!auth) {
                    throw new Error('Auth object not available after wait');
                }
            }

            console.log('üîµ Starting Google popup sign-in...');
            
            // Import auth functions fresh
            const authModule = await import("https://www.gstatic.com/firebasejs/10.13.2/firebase-auth.js");
            const { GoogleAuthProvider, signInWithPopup } = authModule;
            
            const provider = new GoogleAuthProvider();
            provider.setCustomParameters({
                prompt: 'select_account'
            });
            
            // Add scopes for better user info
            provider.addScope('email');
            provider.addScope('profile');
            
            console.log('üîµ Opening popup with provider:', provider);
            
            // Create a timeout promise for the popup
            const signInPromise = signInWithPopup(auth, provider);
            const timeoutPromise = new Promise((_, reject) => 
                setTimeout(() => reject(new Error('Google sign-in timeout')), 60000)
            );
            
            const result = await Promise.race([signInPromise, timeoutPromise]);
            
            console.log('‚úÖ Google sign-in successful:', {
                uid: result.user.uid,
                email: result.user.email,
                displayName: result.user.displayName
            });
            
            // Force UI update
            setTimeout(() => {
                if (result.user) {
                    currentUser = result.user;
                    updateUserInfo();
                    showMainApp();
                }
            }, 500);
            
        } catch (error) {
            console.error('‚ùå Google sign-in failed:', error);
            console.error('Error details:', {
                name: error.name,
                message: error.message,
                code: error.code || 'No error code'
            });
            
            let message = 'Google inloggen mislukt';
            if (error.code === 'auth/popup-blocked') {
                message = 'Login werd geblokkeerd. Sta popups toe voor deze site.';
            } else if (error.code === 'auth/cancelled-popup-request' || error.code === 'auth/popup-closed-by-user') {
                message = 'Login geannuleerd.';
                // Don't show error for user cancellation
                googleBtn.textContent = originalText;
                googleBtn.disabled = false;
                return;
            } else if (error.message.includes('timeout')) {
                message = 'Login duurde te lang. Probeer opnieuw.';
            } else if (error.message.includes('Firebase initialization failed')) {
                message = 'Firebase kon niet worden ge√Ønitialiseerd. Herlaad de pagina.';
            } else if (error.code === 'auth/network-request-failed') {
                message = 'Netwerkfout. Controleer je internetverbinding.';
            }
            
            showUserMessage(message, 'error');
        } finally {
            // Always restore button state
            googleBtn.textContent = originalText;
            googleBtn.disabled = false;
        }
    };

    // Enhanced Email Login
    async function handleLogin(e) {
        e.preventDefault();
        console.log('üìß Email login attempt');
        
        const email = document.getElementById('login-email').value.trim();
        const password = document.getElementById('login-password').value;
        
        console.log('üìß Login details:', { 
            email, 
            passwordLength: password.length,
            emailValid: email.includes('@')
        });
        
        // Validation
        if (!email || !password) {
            showUserMessage('Vul alle velden in', 'warning');
            return;
        }

        if (!email.includes('@') || !email.includes('.')) {
            showUserMessage('Voer een geldig email adres in', 'warning');
            return;
        }

        // Ensure Firebase is ready
        if (!authInitialized || !auth) {
            console.log('‚ö†Ô∏è Firebase not initialized for email login');
            showUserMessage('Bezig met laden van Firebase...', 'info');
            const initialized = await initializeFirebase();
            if (!initialized) {
                showUserMessage('Firebase niet beschikbaar. Herlaad de pagina.', 'error');
                return;
            }
        }

        const submitBtn = e.target.querySelector('button[type="submit"]');
        const originalText = submitBtn.textContent;
        
        try {
            submitBtn.textContent = 'Bezig met inloggen...';
            submitBtn.disabled = true;
            
            console.log('üìß Attempting email sign-in...');
            
            // Import fresh auth functions
            const authModule = await import("https://www.gstatic.com/firebasejs/10.13.2/firebase-auth.js");
            const { signInWithEmailAndPassword } = authModule;
            
            const result = await signInWithEmailAndPassword(auth, email, password);
            
            console.log('‚úÖ Email sign-in successful:', {
                uid: result.user.uid,
                email: result.user.email,
                emailVerified: result.user.emailVerified
            });
            
            e.target.reset();
            
            // Force UI update
            setTimeout(() => {
                if (result.user) {
                    currentUser = result.user;
                    updateUserInfo();
                    showMainApp();
                }
            }, 500);
            
        } catch (error) {
            console.error('‚ùå Email sign-in failed:', error);
            console.error('Error details:', {
                name: error.name,
                message: error.message,
                code: error.code || 'No error code'
            });
            
            let message = 'Inloggen mislukt';
            if (error.code === 'auth/user-not-found') {
                message = 'Geen account gevonden met dit email adres. Maak eerst een account aan.';
            } else if (error.code === 'auth/wrong-password') {
                message = 'Verkeerd wachtwoord. Probeer opnieuw.';
            } else if (error.code === 'auth/invalid-email') {
                message = 'Ongeldig email adres';
            } else if (error.code === 'auth/invalid-credential') {
                message = 'Ongeldige inloggegevens. Controleer email en wachtwoord.';
            } else if (error.code === 'auth/too-many-requests') {
                message = 'Te veel mislukte pogingen. Wacht even en probeer opnieuw.';
            } else if (error.code === 'auth/network-request-failed') {
                message = 'Netwerkfout. Controleer je internetverbinding.';
            } else if (error.code === 'auth/internal-error') {
                message = 'Interne fout. Probeer het later opnieuw.';
            }
            
            showUserMessage(message, 'error');
            
            // Focus back to email field for retry
            setTimeout(() => {
                document.getElementById('login-email').focus();
            }, 100);
            
        } finally {
            submitBtn.textContent = originalText;
            submitBtn.disabled = false;
        }
    }

    async function handleRegister(e) {
        e.preventDefault();
        console.log('üÜï Registration attempt');
        
        const name = document.getElementById('register-name').value.trim();
        const email = document.getElementById('register-email').value.trim();
        const password = document.getElementById('register-password').value;
        
        console
