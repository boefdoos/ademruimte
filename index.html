<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ademruimte - Hyperventilatie Helper</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #06b6d4 0%, #10b981 50%, #3b82f6 100%);
            min-height: 100vh;
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        header {
            background: linear-gradient(135deg, #06b6d4, #10b981);
            color: white;
            padding: 1rem;
            text-align: center;
            position: relative;
            min-height: 60px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            box-shadow: 0 8px 32px rgba(6, 182, 212, 0.3);
            backdrop-filter: blur(10px);
        }

        header h1 {
            font-size: 1.4rem;
            font-weight: 700;
            margin: 0;
            letter-spacing: -0.02em;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
            color: white;
        }

        header p {
            font-size: 0.75rem;
            opacity: 0.95;
            margin: 0.25rem 0 0 0;
            color: rgba(255,255,255,0.95);
        }

        .user-info {
            position: absolute;
            top: 0.5rem;
            right: 0.75rem;
            font-size: 0.7rem;
            color: rgba(255,255,255,0.8);
            max-width: 120px;
            line-height: 1.2;
            word-break: break-word;
        }

        .nav-tabs {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 2px solid rgba(102, 126, 234, 0.2);
            padding: 0.5rem;
            overflow-x: auto;
            white-space: nowrap;
            -webkit-overflow-scrolling: touch;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        .nav-tabs button {
            background: none;
            border: none;
            padding: 0.75rem 1rem;
            margin-right: 0.25rem;
            border-radius: 0.75rem;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 500;
            transition: all 0.3s ease;
            white-space: nowrap;
            min-height: 44px;
            touch-action: manipulation;
            color: #6b7280;
        }

        .nav-tabs button.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
            transform: translateY(-1px);
        }

        .nav-tabs button:hover:not(.active) {
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
        }

        .container {
            max-width: 100%;
            margin: 0 auto;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            min-height: calc(100vh - 120px);
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .card h2 {
            color: #1f2937;
            margin-bottom: 1rem;
            font-size: 1.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, #06b6d4, #10b981);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .card h3 {
            color: #1f2937;
            margin-bottom: 0.75rem;
            font-size: 1.25rem;
            font-weight: 600;
        }

        .grid {
            display: grid;
            gap: 1.5rem;
            grid-template-columns: 1fr;
        }

        .grid .card {
            background: linear-gradient(135deg, rgba(255,255,255,0.9), rgba(255,255,255,0.7));
            border-radius: 1.2rem;
            padding: 2rem;
            text-align: center;
            position: relative;
            overflow: hidden;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .grid .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
        }

        .grid .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 1.2rem 1.2rem 0 0;
        }

        .grid .card h3 {
            font-size: 1.375rem;
            margin-bottom: 1rem;
            font-weight: 700;
        }

        .grid .card p {
            color: #6b7280;
            margin-bottom: 1.5rem;
            font-size: 0.95rem;
        }

        .btn {
            padding: 1rem 1.5rem;
            border: none;
            border-radius: 0.75rem;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 600;
            transition: all 0.3s ease;
            text-align: center;
            display: inline-block;
            text-decoration: none;
            min-height: 48px;
            touch-action: manipulation;
            user-select: none;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #5a6fd8, #6a4190);
        }

        .btn-green {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }

        .btn-green:hover {
            background: linear-gradient(135deg, #0ea370, #047857);
        }

        .btn-orange {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
        }

        .btn-orange:hover {
            background: linear-gradient(135deg, #e08e0b, #c76506);
        }

        .btn-red {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
        }

        .btn-red:hover {
            background: linear-gradient(135deg, #e53935, #c62828);
        }

        .btn-purple {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            color: white;
        }

        .btn-purple:hover {
            background: linear-gradient(135deg, #7c4ee4, #6d28d9);
        }

        .btn-cyan {
            background: linear-gradient(135deg, #06b6d4, #0891b2);
            color: white;
        }

        .btn-cyan:hover {
            background: linear-gradient(135deg, #0ea5c7, #0e7490);
        }

        .alert {
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
            font-size: 0.9rem;
        }

        .alert-info {
            background: #dbeafe;
            border: 1px solid #bfdbfe;
            color: #1e40af;
        }

        .alert-success {
            background: #d1fae5;
            border: 1px solid #a7f3d0;
            color: #065f46;
        }

        .alert-warning {
            background: #fef3c7;
            border: 1px solid #fde68a;
            color: #92400e;
        }

        .alert-danger {
            background: #fee2e2;
            border: 1px solid #fecaca;
            color: #991b1b;
        }

        .timer-display {
            font-size: 2.5rem;
            font-weight: bold;
            text-align: center;
            color: #1f2937;
            margin: 1.5rem 0;
            font-family: 'Courier New', monospace;
        }

        .breath-display {
            font-size: 2rem;
            font-weight: bold;
            text-align: center;
            margin: 1.5rem 0;
            padding: 1.5rem;
            border-radius: 1rem;
            transition: all 0.3s ease;
            min-height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .breath-display.inhale {
            background: linear-gradient(135deg, #dbeafe, #bfdbfe);
            color: #1e40af;
            transform: scale(1.02);
        }

        .breath-display.exhale {
            background: linear-gradient(135deg, #d1fae5, #a7f3d0);
            color: #065f46;
            transform: scale(0.98);
        }

        .breath-display.hold {
            background: linear-gradient(135deg, #fef3c7, #fde68a);
            color: #92400e;
            transform: scale(1.01);
        }

        .breath-display.rest {
            background: linear-gradient(135deg, #f3f4f6, #e5e7eb);
            color: #6b7280;
        }

        .progress-bar {
            width: 100%;
            height: 0.75rem;
            background: #e5e7eb;
            border-radius: 0.375rem;
            overflow: hidden;
            margin: 1rem 0;
        }

        .progress-fill {
            height: 100%;
            background: #10b981;
            border-radius: 0.375rem;
            transition: width 0.3s ease;
        }

        .breath-progress {
            height: 100%;
            border-radius: 0.375rem;
            transition: width linear;
        }

        .breath-progress.inhale {
            background: #3b82f6;
        }

        .breath-progress.exhale {
            background: #10b981;
        }

        .breath-progress.gentle-breath {
            background: #06b6d4;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #374151;
            font-size: 0.9rem;
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            font-size: 0.9rem;
            min-height: 48px;
        }

        .form-textarea {
            resize: vertical;
            min-height: 80px;
        }

        .range-input {
            width: 100%;
            margin: 0.75rem 0;
            height: 8px;
            -webkit-appearance: none;
            appearance: none;
            background: #e5e7eb;
            border-radius: 5px;
            outline: none;
        }

        .range-input::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            background: #3b82f6;
            border-radius: 50%;
            cursor: pointer;
        }

        .range-input::-moz-range-thumb {
            width: 24px;
            height: 24px;
            background: #3b82f6;
            border-radius: 50%;
            cursor: pointer;
            border: none;
        }

        .range-value {
            text-align: center;
            font-weight: bold;
            font-size: 1.25rem;
            color: #3b82f6;
            margin: 0.5rem 0;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            padding: 1rem;
        }

        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            border-radius: 0.75rem;
            padding: 1.5rem;
            max-width: 400px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #6b7280;
            margin-left: auto;
            min-width: 40px;
            min-height: 40px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .stat-card {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
            border-radius: 1rem;
            padding: 1.5rem;
            text-align: center;
            border: 1px solid rgba(102, 126, 234, 0.2);
            backdrop-filter: blur(10px);
            transition: transform 0.2s ease;
        }

        .stat-card:hover {
            transform: translateY(-2px);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            font-size: 0.85rem;
            color: #6b7280;
            font-weight: 500;
        }

        .technique-card {
            background: linear-gradient(135deg, rgba(255,255,255,0.9), rgba(255,255,255,0.7));
            border: 1px solid rgba(102, 126, 234, 0.2);
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 1rem;
            backdrop-filter: blur(10px);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .technique-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.15);
        }

        .technique-card h4 {
            color: #667eea;
            margin-bottom: 0.75rem;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .technique-card p {
            font-size: 0.95rem;
            line-height: 1.6;
            color: #4b5563;
        }

        .entry-card {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 0.75rem;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .entry-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 0.75rem;
            gap: 1rem;
        }

        .entry-title {
            font-weight: 600;
            color: #1f2937;
            font-size: 0.95rem;
        }

        .entry-result {
            font-size: 0.8rem;
            font-weight: 500;
            white-space: nowrap;
        }

        .entry-result.zeer-goed { color: #059669; }
        .entry-result.goed { color: #10b981; }
        .entry-result.matig { color: #f59e0b; }
        .entry-result.geen-effect { color: #6b7280; }
        .entry-result.slechter { color: #ef4444; }

        .intensity-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 0.75rem;
        }

        .hidden {
            display: none !important;
        }

        .loading {
            opacity: 0.6;
            pointer-events: none;
        }

        .spinner {
            display: inline-block;
            width: 1rem;
            height: 1rem;
            border: 2px solid #f3f4f6;
            border-top: 2px solid #3b82f6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .status-connected {
            color: #059669;
            font-size: 0.7rem;
        }

        .status-disconnected {
            color: #f59e0b;
            font-size: 0.7rem;
        }

        .status-error {
            color: #ef4444;
            font-size: 0.7rem;
        }

        .step-list {
            list-style: none;
            margin: 1rem 0;
        }

        .step-list li {
            padding: 0.75rem 0;
            border-bottom: 1px solid #f3f4f6;
            font-size: 0.9rem;
        }

        .step-list li:before {
            content: "‚úì ";
            color: #10b981;
            font-weight: bold;
        }

        .login-container {
            max-width: 400px;
            margin: 2rem auto;
            padding: 0 1rem;
        }

        .login-card {
            background: white;
            border-radius: 0.75rem;
            padding: 2rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            border: 1px solid #e5e7eb;
        }

        .divider {
            text-align: center;
            margin: 1.5rem 0;
            position: relative;
            color: #6b7280;
            font-size: 0.875rem;
        }

        .divider::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 1px;
            background: #e5e7eb;
            z-index: 1;
        }

        .divider span {
            background: white;
            padding: 0 1rem;
            position: relative;
            z-index: 2;
        }

        .google-btn {
            width: 100%;
            padding: 0.875rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            background: white;
            color: #374151;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.2s;
            min-height: 48px;
        }

        .google-btn:hover {
            background: #f9fafb;
            border-color: #9ca3af;
        }

        .breath-controls {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1rem;
            margin: 1rem 0;
        }

        .breath-setting {
            text-align: center;
            padding: 1rem;
            background: #f8fafc;
            border-radius: 0.5rem;
            border: 1px solid #e2e8f0;
        }

        .breath-setting label {
            display: block;
            font-size: 0.875rem;
            color: #6b7280;
            margin-bottom: 0.5rem;
        }

        .breath-setting input {
            width: 80px;
            text-align: center;
            font-size: 1.125rem;
            font-weight: bold;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            padding: 0.5rem;
            min-height: 44px;
        }

        .button-group {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin: 1rem 0;
        }

        .button-group .btn {
            flex: 1;
            min-width: 120px;
        }

        .settings-section {
            background: #f8fafc;
            border-radius: 0.75rem;
            padding: 1.5rem;
            margin: 2rem 0;
            border: 1px solid #e2e8f0;
        }

        .settings-section h3 {
            color: #374151;
            margin-bottom: 1rem;
            font-size: 1rem;
        }

        footer {
            text-align: center;
            padding: 2rem 1rem;
            color: #6b7280;
            font-size: 0.8rem;
        }

        /* CSS Chart Styles */
        .chart-container {
            position: relative;
            width: 100%;
            height: 100%;
        }

        .chart-y-axis {
            position: absolute;
            left: 0;
            top: 0;
            bottom: 40px;
            width: 30px;
            display: flex;
            flex-direction: column-reverse;
            justify-content: space-between;
            padding: 10px 0;
            font-size: 0.75rem;
            color: #6b7280;
        }

        .line-chart {
            position: absolute;
            left: 40px;
            right: 0;
            top: 10px;
            bottom: 40px;
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            border-left: 1px solid #e5e7eb;
            border-bottom: 1px solid #e5e7eb;
            padding: 0 10px 10px 10px;
        }

        .chart-session {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            flex: 1;
            max-width: 60px;
        }

        .chart-point {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            position: relative;
            cursor: pointer;
        }

        .chart-point.voor {
            background: #ef4444;
            border: 2px solid #dc2626;
        }

        .chart-point.na {
            background: #10b981;
            border: 2px solid #059669;
        }

        .chart-session-label {
            position: absolute;
            bottom: -25px;
            font-size: 0.7rem;
            color: #6b7280;
            text-align: center;
            width: 100%;
        }

        .chart-legend {
            position: absolute;
            bottom: 0;
            right: 0;
            display: flex;
            gap: 1rem;
            font-size: 0.75rem;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .legend-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .legend-dot.voor {
            background: #ef4444;
        }

        .legend-dot.na {
            background: #10b981;
        }

        .bar-chart {
            height: 180px;
            display: flex;
            align-items: flex-end;
            justify-content: space-around;
            gap: 1rem;
            padding: 1rem;
            border-bottom: 1px solid #e5e7eb;
            border-left: 1px solid #e5e7eb;
        }

        .bar {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 4px 4px 0 0;
            min-width: 40px;
            max-width: 60px;
            flex: 1;
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
        }

        .bar:hover {
            opacity: 0.8;
            transform: translateY(-2px);
        }

        .bar-value {
            color: white;
            font-size: 0.7rem;
            font-weight: 600;
            padding: 0.25rem;
            text-align: center;
        }

        .bar-label {
            position: absolute;
            bottom: -25px;
            font-size: 0.7rem;
            color: #6b7280;
            text-align: center;
            width: 100%;
            word-break: break-word;
            line-height: 1.1;
        }

        /* Desktop optimizations */
        @media (min-width: 768px) {
            header {
                padding: 1.5rem 1rem;
                min-height: 80px;
            }
            
            header h1 {
                font-size: 1.75rem;
                margin-bottom: 0.25rem;
            }

            header p {
                font-size: 0.9rem;
            }

            .user-info {
                top: 1rem;
                right: 1rem;
                font-size: 0.8rem;
                max-width: 160px;
            }
            
            .container {
                max-width: 1200px;
                padding: 2rem 1rem;
            }
            
            .grid {
                grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            }
            
            .timer-display {
                font-size: 3rem;
            }

            .breath-display {
                font-size: 2.5rem;
                padding: 2rem;
            }

            .breath-controls {
                grid-template-columns: 1fr 1fr 1fr;
            }
        }

        /* Large screen optimizations */
        @media (min-width: 1024px) {
            header h1 {
                font-size: 2rem;
            }
        }

        /* Touch optimizations */
        @media (hover: none) and (pointer: coarse) {
            .btn {
                min-height: 44px;
                padding: 1rem 1.5rem;
            }
            
            .nav-tabs button {
                min-height: 44px;
                padding: 1rem 1.25rem;
            }
            
            .user-info button {
                min-height: 44px;
                min-width: 88px;
            }
        }

        /* Landscape phone optimizations */
        @media (max-height: 500px) and (orientation: landscape) {
            header {
                padding: 1rem;
            }
            
            header h1 {
                font-size: 1.5rem;
                margin-bottom: 0.25rem;
            }
            
            .container {
                padding: 0.5rem;
            }
            
            .timer-display, .breath-display {
                font-size: 1.5rem;
                margin: 0.5rem 0;
                padding: 1rem;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="user-info" id="user-info">
            <div class="spinner" id="auth-loading"></div>
        </div>
        <h1>ü´Å Ademruimte</h1>
        <p>Jouw persoonlijke hyperventilatie helper</p>
        <div id="firebase-status" class="status-disconnected">
            üî• Firebase: Initialiseren...
        </div>
    </header>

    <!-- Login Screen -->
    <div id="login-screen" class="hidden">
        <div class="login-container">
            <div class="login-card">
                <h2 style="text-align: center; margin-bottom: 1.5rem; color: #1f2937;">
                    Welkom bij Ademruimte
                </h2>
                
                <p style="text-align: center; margin-bottom: 2rem; color: #6b7280;">
                    Log in om je vooruitgang op te slaan en te synchroniseren tussen al je apparaten.
                </p>

                <!-- Google Login -->
                <button class="google-btn" onclick="signInWithGoogle()">
                    <svg width="18" height="18" viewBox="0 0 24 24">
                        <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                        <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                        <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                        <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                    </svg>
                    Doorgaan met Google
                </button>

                <div class="divider">
                    <span>of</span>
                </div>

                <!-- Email/Password Login -->
                <form id="login-form">
                    <div class="form-group">
                        <label class="form-label">E-mail:</label>
                        <input type="email" id="login-email" class="form-input" placeholder="jouw@email.com" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Wachtwoord:</label>
                        <input type="password" id="login-password" class="form-input" placeholder="Wachtwoord" required>
                    </div>

                    <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 1.5rem;">
                        <input type="checkbox" id="remember-me" checked style="width: 20px; height: 20px;">
                        <label for="remember-me" style="font-size: 0.875rem; margin: 0; cursor: pointer;">Ingelogd blijven</label>
                    </div>

                    <button type="submit" class="btn btn-primary" style="width: 100%; margin-bottom: 1rem;">
                        Inloggen
                    </button>
                </form>

                <div style="text-align: center;">
                    <p style="color: #6b7280; font-size: 0.875rem; margin-bottom: 1rem;">
                        Nog geen account?
                    </p>
                    <button class="btn btn-green" onclick="showRegisterForm()" style="width: 100%;">
                        Account Aanmaken
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Register Modal -->
    <div id="register-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Account Aanmaken</h3>
                <button class="close-btn" onclick="closeRegisterModal()">&times;</button>
            </div>
            
            <form id="register-form">
                <div class="form-group">
                    <label class="form-label">Naam:</label>
                    <input type="text" id="register-name" class="form-input" placeholder="Jouw naam" required>
                </div>

                <div class="form-group">
                    <label class="form-label">E-mail:</label>
                    <input type="email" id="register-email" class="form-input" placeholder="jouw@email.com" required>
                </div>

                <div class="form-group">
                    <label class="form-label">Wachtwoord:</label>
                    <input type="password" id="register-password" class="form-input" placeholder="Minimaal 6 karakters" required minlength="6">
                </div>

                <div class="button-group">
                    <button type="submit" class="btn btn-green">
                        Account Aanmaken
                    </button>
                    <button type="button" class="btn btn-orange" onclick="closeRegisterModal()">
                        Annuleren
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Main App (hidden until logged in) -->
    <div id="main-app" class="hidden">
        <nav class="nav-tabs">
            <button class="tab-btn active" data-tab="dashboard">üè† Dashboard</button>
            <button class="tab-btn" data-tab="crisis">üö® Crisis</button>
            <button class="tab-btn" data-tab="buteyko">üå¨Ô∏è Buteyko</button>
            <button class="tab-btn" data-tab="ritueel">üïê Ritueel</button>
            <button class="tab-btn" data-tab="gapen">ü•± Gapen</button>
            <button class="tab-btn" data-tab="emdr">üíú EMDR</button>
            <button class="tab-btn" data-tab="dagboek">üìñ Dagboek</button>
        </nav>

        <div class="container">
            <!-- Dashboard Tab -->
            <div id="dashboard" class="tab-content">
                <div class="card">
                    <h2>Welkom bij Ademruimte</h2>
                    <p>Jouw persoonlijke hulp voor het omgaan met hyperventilatie en luchthonger-gevoelens.</p>
                </div>

                <div class="grid">
                    <div class="card">
                        <h3>üö® Crisis Hulp</h3>
                        <p>Voor wanneer je luchthonger voelt opkomen</p>
                        <button class="btn btn-red" onclick="showTab('crisis')">Open Crisis Hulp</button>
                    </div>

                    <div class="card">
                        <h3>üå¨Ô∏è Buteyko Ademhaling</h3>
                        <p>CO2 tolerantie training</p>
                        <button class="btn btn-cyan" onclick="showTab('buteyko')">Start Buteyko</button>
                    </div>

                    <div class="card">
                        <h3>üïê Afkoel Ritueel</h3>
                        <p>Na intensief denkwerk</p>
                        <button class="btn btn-green" onclick="showTab('ritueel')">Start Ritueel</button>
                    </div>

                    <div class="card">
                        <h3>ü•± Gaap Preventie</h3>
                        <p>Technieken voor gaapaanvallen</p>
                        <button class="btn btn-orange" onclick="showTab('gapen')">Bekijk Technieken</button>
                    </div>

                    <div class="card">
                        <h3>üíú EMDR Zelfhulp</h3>
                        <p>Voor luchthonger-gevoelens</p>
                        <button class="btn btn-purple" onclick="showTab('emdr')">Start EMDR</button>
                    </div>

                    <div class="card">
                        <h3>üìñ Dagboek</h3>
                        <p>Bijhouden van patronen</p>
                        <button class="btn btn-primary" onclick="showTab('dagboek')">Open Dagboek</button>
                    </div>
                </div>

                <div class="alert alert-info">
                    <strong>üí° Tip van de dag:</strong> <span id="daily-tip">Gaapaanvallen zijn een waarschuwingssignaal, geen bedreiging. Gebruik ze als mogelijkheid om preventief in te grijpen.</span>
                    <button id="tip-refresh-btn" style="background: none; border: none; color: #0891b2; cursor: pointer; margin-left: 0.5rem; font-weight: 600; font-size: 1rem; transition: all 0.3s ease; padding: 0.25rem; border-radius: 0.25rem;" onmouseover="this.style.background='rgba(8,145,178,0.1)'; this.style.transform='scale(1.1)'" onmouseout="this.style.background='none'; this.style.transform='scale(1)'" title="Nieuwe tip">üîÑ</button>
                </div>

                <!-- Data Migration Section (if needed) -->
                <div class="settings-section" id="migration-section" style="display: none;">
                    <h3>üì§ Data Migratie</h3>
                    <p style="color: #6b7280; font-size: 0.9rem; margin-bottom: 1rem;">
                        Heb je eerder de app gebruikt zonder account? Migreer je lokale data naar je cloud account.
                    </p>
                    <div class="button-group">
                        <button class="btn btn-green" onclick="migrateLocalData()">
                            üì§ Migreer Lokale Data
                        </button>
                    </div>
                </div>

                <!-- Account Settings Section -->
                <div class="settings-section">
                    <h3>üë§ Account</h3>
                    <div id="account-info" style="margin-bottom: 1rem;">
                        <!-- Account info wordt hier ingevuld -->
                    </div>
                    <div class="button-group">
                        <button class="btn btn-red" onclick="performLogout()">
                            üö™ Uitloggen
                        </button>
                    </div>
                </div>
            </div>

            <!-- Crisis Tab -->
            <div id="crisis" class="tab-content hidden">
                <div class="card">
                    <h2>üö® Crisis Hulp - Luchthonger</h2>
                    <p>Voor wanneer je dat benauwde gevoel voelt opkomen</p>
                </div>

                <div class="technique-card">
                    <h4>1. Paradoxale Ademhaling</h4>
                    <p>Start met bewust zeer kleine, korte ademhalingen. Na 3-4 van deze mini-ademhalingen, probeer een iets langere uitademing.</p>
                </div>

                <div class="technique-card">
                    <h4>2. Purse-lip Ademhaling</h4>
                    <p>Tuut je lippen bij het uitademen om lichte weerstand te cre√´ren. Dit helpt bij luchthonger en stabiliseert CO2-niveaus.</p>
                </div>

                <div class="technique-card">
                    <h4>3. IJswater Techniek</h4>
                    <p>Breng iets kouds tegen je gezicht (vooral rond wangen en ogen) om de duikreflex te activeren.</p>
                </div>

                <div class="technique-card">
                    <h4>4. Herframing</h4>
                    <p>"Dit is geen echt zuurstoftekort, dit is een sensatie die voorbij zal gaan. Mijn lichaam krijgt genoeg zuurstof."</p>
                </div>

                <div class="card">
                    <h3>5-4-3-2-1 Grounding</h3>
                    <ul class="step-list">
                        <li>5 dingen die je ZIET</li>
                        <li>4 dingen die je VOELT</li>
                        <li>3 dingen die je HOORT</li>
                        <li>2 dingen die je RUIKT</li>
                        <li>1 ding dat je PROEFT</li>
                    </ul>
                </div>

                <div class="card">
                    <button class="btn btn-primary" onclick="openDagboekModal('Crisis Hulp Technieken')">
                        üìù Dagboek Entry Maken
                    </button>
                </div>
            </div>

            <!-- Buteyko Tab -->
            <div id="buteyko" class="tab-content hidden">
                <div class="card">
                    <h2>üå¨Ô∏è Buteyko Ademhaling</h2>
                    <p>Verbeter je CO2 tolerantie en verminder hyperventilatie neiging</p>
                </div>

                <div class="alert alert-info">
                    <strong>üí° Hoe het werkt:</strong> Buteyko ademhaling helpt je lichaam wennen aan hogere CO2 niveaus, wat hyperventilatie-episodes kan verminderen.
                </div>

                <div class="card">
                    <h3>Ademhaling Instellingen</h3>
                    <div style="margin-bottom: 1rem;">
                        <label style="font-weight: 500; margin-bottom: 0.5rem; display: block;">Ademhaling Patroon:</label>
                        <select id="breathing-pattern" class="form-select" onchange="updateBreathingPattern()">
                            <option value="standard">Standaard (4-6-3)</option>
                            <option value="gentle">Zacht (2x ademhaling + pauze)</option>
                        </select>
                    </div>
                    
                    <div id="standard-controls" class="breath-controls">
                        <div class="breath-setting">
                            <label>Inademen (sec)</label>
                            <input type="number" id="inhale-duration" value="4" min="2" max="10">
                        </div>
                        <div class="breath-setting">
                            <label>Uitademen (sec)</label>
                            <input type="number" id="exhale-duration" value="6" min="3" max="15">
                        </div>
                        <div class="breath-setting">
                            <label>Pauze (sec)</label>
                            <input type="number" id="hold-duration" value="3" min="1" max="20">
                        </div>
                    </div>

                    <div id="gentle-controls" class="breath-controls hidden">
                        <div class="breath-setting">
                            <label>Cyclus Tijd (sec)</label>
                            <input type="number" id="gentle-cycle" value="10" min="8" max="15" readonly>
                        </div>
                        <div class="breath-setting">
                            <label>Pauze (sec)</label>
                            <input type="number" id="gentle-pause" value="4" min="2" max="8">
                        </div>
                        <div class="breath-setting">
                            <label>Ademhalingen</label>
                            <div style="font-weight: bold; color: #3b82f6; margin-top: 0.5rem;">2x per cyclus</div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="breath-display rest" id="breath-display">
                        Klik op start om te beginnen
                    </div>

                    <div class="progress-bar">
                        <div class="breath-progress" id="breath-progress" style="width: 0%"></div>
                    </div>

                    <div style="text-align: center; margin: 1rem 0;">
                        <div id="breath-cycle-counter" style="font-size: 1.125rem; color: #6b7280; margin-bottom: 1rem;">
                            Cyclus: 0
                        </div>
                        
                        <div class="button-group">
                            <button id="breath-btn" class="btn btn-cyan" onclick="toggleBreathExercise()">
                                ‚ñ∂Ô∏è Start Buteyko
                            </button>
                            <button class="btn btn-orange" onclick="resetBreathExercise()">
                                üîÑ Reset
                            </button>
                        </div>
                    </div>

                    <div id="breath-complete" class="alert alert-success hidden">
                        <strong>‚úÖ Buteyko Sessie Voltooid!</strong><br>
                        Goed gedaan! Je hebt een volledige ademhalingssessie afgerond.
                        <br><br>
                        <button class="btn btn-primary" onclick="openDagboekModal('Buteyko Ademhaling')">
                            üìù Dagboek Entry Maken
                        </button>
                    </div>
                </div>

                <div class="card">
                    <h3>Buteyko Principes</h3>
                    <div class="technique-card">
                        <h4>Zachte Ademhaling</h4>
                        <p>Adem zo zacht mogelijk - stel je voor dat je een veertje voor je neus niet wilt laten bewegen.</p>
                    </div>
                    <div class="technique-card">
                        <h4>Langere Uitademing</h4>
                        <p>De uitademing is langer dan de inademing om CO2 te behouden en het autonome zenuwstelsel te kalmeren.</p>
                    </div>
                    <div class="technique-card">
                        <h4>Comfortabele Pauze</h4>
                        <p>De ademhpauze na uitademing mag nooit geforceerd aanvoelen - stop als het oncomfortabel wordt.</p>
                    </div>
                </div>
            </div>

            <!-- Ritueel Tab -->
            <div id="ritueel" class="tab-content hidden">
                <div class="card">
                    <h2>üïê Afkoel Ritueel</h2>
                    <p>Voor na periodes van intensief denkwerk (5-10 minuten)</p>
                </div>

                <div class="card">
                    <h3 id="ritual-title">Stap 1: Fysieke Mini-Reset</h3>
                    <div class="timer-display" id="timer-display">2:00</div>
                    
                    <div id="ritual-instructions">
                        <ul class="step-list">
                            <li>Sta op en strek je volledig uit</li>
                            <li>Schud je armen en benen los</li>
                            <li>Rol je schouders 5x naar achteren</li>
                            <li>Maak kleine cirkels met je hoofd (5x elke richting)</li>
                        </ul>
                    </div>

                    <div class="button-group">
                        <button id="timer-btn" class="btn btn-green" onclick="startTimer()">‚ñ∂Ô∏è Start Timer</button>
                        <button class="btn btn-primary" onclick="nextRitualStep()" id="next-btn" style="display: none;">Volgende Stap</button>
                        <button class="btn btn-cyan" onclick="skipToNextStep()" id="skip-btn">‚è≠Ô∏è Overslaan</button>
                        <button class="btn btn-orange" onclick="resetRitual()">üîÑ Reset</button>
                    </div>

                    <div class="progress-bar">
                        <div class="progress-fill" id="ritual-progress" style="width: 20%"></div>
                    </div>

                    <div id="ritual-complete" class="alert alert-success hidden">
                        <strong>‚úÖ Afkoel Ritueel Voltooid!</strong><br>
                        Goed gedaan! Je hebt alle stappen doorlopen.
                        <br><br>
                        <button class="btn btn-primary" onclick="openDagboekModal('Afkoel Ritueel')">
                            üìù Dagboek Entry Maken
                        </button>
                    </div>
                </div>
            </div>

            <!-- Gapen Tab -->
            <div id="gapen" class="tab-content hidden">
                <div class="card">
                    <h2>ü•± Gaap Preventie Technieken</h2>
                    <p>Voor wanneer je die vervelende gaapaanvallen voelt opkomen</p>
                </div>

                <div class="technique-card">
                    <h4>Lipremming-techniek</h4>
                    <p>Druk je lippen zachtjes op elkaar wanneer je een gaapneiging voelt. Laat de lucht langzaam door je neus in en uit gaan.</p>
                </div>

                <div class="technique-card">
                    <h4>Mini-ademhalingen</h4>
                    <p>Neem bewust 3-4 zeer kleine, ondiepe ademhalingen door je neus. Hiermee voorkom je de grote 'zucht-ademhaling'.</p>
                </div>

                <div class="technique-card">
                    <h4>Tongpositie veranderen</h4>
                    <p>Plaats je tongpunt tegen je gehemelte (achter je voortanden). Dit vermindert de neiging tot gapen.</p>
                </div>

                <div class="technique-card">
                    <h4>Water drinken</h4>
                    <p>Neem kleine slokjes water wanneer je merkt dat je begint te gapen. Dit doorbreekt het ademhalingspatroon.</p>
                </div>

                <div class="alert alert-info">
                    <strong>üí° Belangrijk om te onthouden:</strong> Gaapaanvallen zijn een waarschuwingssignaal, geen bedreiging. Ze geven je de kans om preventief in te grijpen voordat een volledige hyperventilatie-episode begint.
                </div>

                <div class="card">
                    <h3>Gedachte-Breaking Technieken</h3>
                    <div class="technique-card">
                        <strong>Paradoxale intentie:</strong> "Ok√© hersenen, jullie willen dat ik ga gapen? Prima, ik ga nu heel bewust gapen"
                    </div>
                    <div class="technique-card">
                        <strong>Herframing:</strong> "Mijn brein probeert me te beschermen, maar ik hoef niet te reageren"
                    </div>
                    <div class="technique-card">
                        <strong>Aandacht verplaatsen:</strong> Tel 5 blauwe dingen die je kunt zien
                    </div>
                </div>

                <div class="card">
                    <button class="btn btn-primary" onclick="openDagboekModal('Gaap Preventie Technieken')">
                        üìù Dagboek Entry Maken
                    </button>
                </div>
            </div>

            <!-- EMDR Tab -->
            <div id="emdr" class="tab-content hidden">
                <div class="card">
                    <h2>üíú EMDR Zelfhulp</h2>
                    <p>Voor luchthonger-gevoelens (dit is ondersteuning, geen vervanging voor professionele EMDR)</p>
                </div>

                <div class="alert alert-warning">
                    <strong>‚ö†Ô∏è Gebruik dit alleen voor milde tot matige gevoelens. Stop als je je overweldigd voelt.</strong>
                </div>

                <div class="alert alert-info">
                    <strong>üéß Bilaterale Audio:</strong> Voor de beste ervaring, gebruik koptelefoon of oortjes. Zet het volume op een comfortabel niveau voordat je begint.
                </div>

                <!-- Audio Controls -->
                <div class="card">
                    <h3>üîä Bilaterale Audio Stimulatie</h3>
                    <p style="margin-bottom: 1rem;">Een 880Hz toon die van links naar rechts beweegt om bilaterale hersenstimulatie te ondersteunen.</p>
                    
                    <div class="breath-controls">
                        <div class="breath-setting">
                            <label>Volume (%)</label>
                            <input type="number" id="audio-volume" value="30" min="10" max="100" step="10">
                        </div>
                        <div class="breath-setting">
                            <label>Snelheid (sec)</label>
                            <input type="number" id="audio-speed" value="2" min="1" max="5" step="0.5">
                        </div>
                        <div class="breath-setting">
                            <label>Status</label>
                            <div id="audio-status" style="font-weight: bold; color: #6b7280; margin-top: 0.5rem;">Gestopt</div>
                        </div>
                    </div>

                    <div class="button-group">
                        <button id="audio-btn" class="btn btn-purple" onclick="toggleBilateralAudio()">
                            üîä Start Audio
                        </button>
                        <button class="btn btn-orange" onclick="stopBilateralAudio()">
                            üîá Stop Audio
                        </button>
                    </div>
                </div>

                <div class="card">
                    <h3 id="emdr-title">Stap 1: Voorbereiding</h3>
                    <div id="emdr-content">
                        <p>Zorg dat je in een veilige, rustige ruimte bent. Heb water binnen handbereik. Stop als het te overweldigend wordt.</p>
                    </div>

                    <div id="emdr-intensity" class="hidden">
                        <div class="form-group">
                            <label class="form-label">Intensiteit van luchthonger-gevoel (1-10):</label>
                            <input type="range" min="1" max="10" value="5" class="range-input" id="emdr-intensity-slider">
                            <div class="range-value" id="emdr-intensity-value">5</div>
                        </div>
                    </div>

                    <div class="button-group">
                        <button id="emdr-prev-btn" class="btn btn-orange" onclick="prevEmdrStep()" style="display: none;">Vorige</button>
                        <button id="emdr-next-btn" class="btn btn-purple" onclick="nextEmdrStep()">Volgende</button>
                    </div>

                    <div class="progress-bar">
                        <div class="progress-fill" id="emdr-progress" style="width: 20%"></div>
                    </div>

                    <div id="emdr-complete" class="alert alert-success hidden">
                        <strong>‚úÖ EMDR Sessie Voltooid!</strong><br>
                        <button class="btn btn-primary" onclick="openDagboekModal('EMDR Zelfhulp Sessie')">
                            üìù Dagboek Entry Maken
                        </button>
                    </div>
                </div>
            </div>

            <!-- Dagboek Tab -->
            <div id="dagboek" class="tab-content hidden">
                <div class="card">
                    <h2>üìñ Dagboek</h2>
                    <p>Overzicht van je sessies en vooruitgang</p>
                    <div class="button-group">
                        <button class="btn btn-primary" onclick="openDagboekModal('Handmatige Entry')">
                            ‚ûï Nieuwe Entry
                        </button>
                        <button class="btn btn-green" onclick="loadDagboekEntries()">
                            üîÑ Vernieuw
                        </button>
                        <button class="btn btn-orange" onclick="exportDagboek()">
                            üì• Export Dagboek
                        </button>
                    </div>
                </div>

                <!-- Analytics Section -->
                <div id="analytics-section" class="card" style="display: none;">
                    <h3>üìä Jouw Vooruitgang</h3>
                    
                    <!-- Chart Container -->
                    <div style="margin-bottom: 2rem;">
                        <h4 style="margin-bottom: 1rem; color: #6b7280; font-size: 0.9rem;">Intensiteit Evolutie</h4>
                        <div id="intensity-chart" style="width: 100%; height: 300px; background: rgba(255,255,255,0.5); border-radius: 0.75rem; padding: 1rem;">
                            <!-- Chart will be rendered here -->
                        </div>
                    </div>

                    <!-- Technique Effectiveness -->
                    <div style="margin-bottom: 2rem;">
                        <h4 style="margin-bottom: 1rem; color: #6b7280; font-size: 0.9rem;">Effectiviteit per Techniek</h4>
                        <div id="technique-chart" style="width: 100%; height: 250px; background: rgba(255,255,255,0.5); border-radius: 0.75rem; padding: 1rem;">
                            <!-- Chart will be rendered here -->
                        </div>
                    </div>

                    <!-- Stats Cards -->
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number" id="total-sessions">0</div>
                            <div class="stat-label">Totaal Sessies</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="avg-improvement">0%</div>
                            <div class="stat-label">Gem. Verbetering</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="best-technique">-</div>
                            <div class="stat-label">Beste Techniek</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="streak-days">0</div>
                            <div class="stat-label">Dagen Streak</div>
                        </div>
                    </div>
                </div>

                <div id="dagboek-entries">
                    <!-- Entries worden hier geladen -->
                </div>

                <div class="card">
                    <h3>Patronen om naar uit te kijken</h3>
                    <ul class="step-list">
                        <li>Welke technieken het beste werken voor jou</li>
                        <li>Tijdstippen waarop klachten vaker voorkomen</li>
                        <li>Specifieke triggers (werk, stress, bepaalde gedachten)</li>
                        <li>Verband tussen maagklachten en ademhalingsproblemen</li>
                        <li>Verbetering in intensiteit scores over tijd</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Dagboek Modal -->
    <div id="dagboek-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üìù Dagboek Entry</h3>
                <button class="close-btn" onclick="closeDagboekModal()">&times;</button>
            </div>
            
            <form id="dagboek-form">
                <div class="form-group">
                    <label class="form-label">Situatie/Trigger:</label>
                    <input type="text" id="entry-trigger" class="form-input" placeholder="Bijv. na intensief werken">
                </div>

                <div class="grid">
                    <div class="form-group">
                        <label class="form-label">Intensiteit voor (1-10):</label>
                        <input type="range" min="1" max="10" value="5" class="range-input" id="entry-before">
                        <div class="range-value" id="entry-before-value">5</div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Intensiteit na (1-10):</label>
                        <input type="range" min="1" max="10" value="5" class="range-input" id="entry-after">
                        <div class="range-value" id="entry-after-value">5</div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Resultaat:</label>
                    <select id="entry-result" class="form-select">
                        <option value="">Selecteer resultaat...</option>
                        <option value="zeer-goed">Zeer goed - volledig opgelost</option>
                        <option value="goed">Goed - duidelijke verbetering</option>
                        <option value="matig">Matig - kleine verbetering</option>
                        <option value="geen-effect">Geen effect</option>
                        <option value="slechter">Iets slechter</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">Notities:</label>
                    <textarea id="entry-notes" class="form-textarea" placeholder="Wat viel je op?"></textarea>
                </div>

                <div class="button-group">
                    <button type="button" class="btn btn-primary" onclick="saveDagboekEntry()">
                        üìÅ Opslaan
                    </button>
                    <button type="button" class="btn btn-orange" onclick="closeDagboekModal()">
                        Annuleren
                    </button>
                </div>
            </form>
        </div>
    </div>

    <footer>
        <p>üìû In noodgevallen: contacteer altijd je huisarts of spoeddiensten</p>
    </footer>

    <!-- Firebase en App JavaScript -->
    <script type="module">
        console.log('üöÄ Starting Ademruimte app - Fixed version');

        // Import Firebase modules
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, query, where, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut, onAuthStateChanged, GoogleAuthProvider, signInWithPopup, updateProfile, setPersistence, browserLocalPersistence, browserSessionPersistence } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";

        // Firebase configuratie
        const firebaseConfig = {
            apiKey: "AIzaSyBwDkmbKOzZAyIZW7-ud4qYr7xHyILCdzI",
            authDomain: "ademruimte-12c09.firebaseapp.com",
            projectId: "ademruimte-12c09",
            storageBucket: "ademruimte-12c09.firebasestorage.app",
            messagingSenderId: "744941871331",
            appId: "1:744941871331:web:c3ce24d814fe41314d25d6",
            measurementId: "G-SD2ZEYNMNY"
        };

        // Global variables
        let app, db, auth;
        let currentUser = null;
        let isFirebaseConnected = false;
        let currentTab = 'dashboard';
        let timerInterval = null;
        let currentTime = 0;
        let ritualStep = 0;
        let emdrStep = 0;
        let currentTechnique = '';
        let dagboekEntries = [];

        // Breath exercise variables
        let breathInterval = null;
        let breathPhase = 'rest'; // 'inhale', 'exhale', 'hold', 'rest'
        let breathCycleCount = 0;
        let breathPhaseTime = 0;
        let breathCycleDuration = 0;

        // Audio variables for EMDR
        let audioContext = null;
        let oscillator = null;
        let gainNode = null;
        let pannerNode = null;
        let audioInterval = null;
        let isAudioPlaying = false;
        let panPosition = -1; // Start left (-1), move to right (1)

        // Wake lock for keeping screen on
        let wakeLock = null;

        // Progress tracking
        let progressData = {
            buteyko: { sessions: 0, totalTime: 0, lastSession: null },
            ritual: { sessions: 0, totalTime: 0, lastSession: null },
            emdr: { sessions: 0, totalTime: 0, lastSession: null },
            crisis: { sessions: 0, lastSession: null }
        };

        // Initialize Firebase with better error handling
        try {
            console.log('üîÑ Initializing Firebase...');
            app = initializeApp(firebaseConfig);
            
            console.log('üîÑ Getting Firestore...');
            db = getFirestore(app);
            
            console.log('üîÑ Getting Auth...');
            auth = getAuth(app);
            
            console.log('üîç Firebase objects created:', {
                app: !!app,
                db: !!db, 
                auth: !!auth
            });
            
            // Test Firebase connection
            console.log('üîÑ Testing Firebase connection...');
            collection(db, "test");
            
            isFirebaseConnected = true;
            updateFirebaseStatus('connected', 'üî• Firebase: Actief');
            
            console.log('‚úÖ Firebase successfully initialized and connected');
            
        } catch (error) {
            console.error('‚ùå Firebase initialization error:', error);
            isFirebaseConnected = false;
            updateFirebaseStatus('error', 'üî• Firebase: Offline');
            
            // Show user that they can still use the app
            setTimeout(() => {
                updateFirebaseStatus('disconnected', 'üì± Lokale modus actief');
            }, 3000);
        }

        // Initialize Firebase auth state observer
        setupAuthStateObserver();

        // Function to reset login form and completely re-initialize handlers
        function resetLoginForm() {
            // Clear form fields
            const emailField = document.getElementById('login-email');
            const passwordField = document.getElementById('login-password');
            const rememberCheckbox = document.getElementById('remember-me');
            
            if (emailField) emailField.value = '';
            if (passwordField) passwordField.value = '';
            if (rememberCheckbox) rememberCheckbox.checked = true;
            
            // Clear any form validation states
            document.querySelectorAll('.form-input').forEach(input => {
                input.classList.remove('error', 'success');
            });
            
            // Completely re-setup form handlers with a small delay to ensure DOM is ready
            setTimeout(() => {
                setupLoginFormHandler();
                setupRegisterFormHandler();
                console.log('‚úÖ Login form reset and handlers re-initialized');
            }, 100);
        }

        function updateAccountInfo(user) {
            const accountInfo = document.getElementById('account-info');
            if (accountInfo) {
                accountInfo.innerHTML = 
                    '<p style="color: #6b7280; font-size: 0.9rem;">' +
                    '<strong>Ingelogd als:</strong><br>' + 
                    (user.displayName || user.email) + 
                    '</p>';
            }
        }

        // Force logout with proper Firebase re-initialization
        window.performLogout = async function() {
            if (!confirm('Weet je zeker dat je wilt uitloggen?')) {
                return;
            }
            
            // Stop any running services immediately
            if (isAudioPlaying) stopBilateralAudio();
            if (wakeLock) releaseWakeLock();
            
            // Clear global state
            currentUser = null;
            
            try {
                // Try proper Firebase signOut first
                if (auth && auth.currentUser) {
                    await signOut(auth);
                }
            } catch (error) {
                console.log('SignOut error (continuing with force logout):', error);
            }
            
            // Clear all Firebase auth data from localStorage
            const keys = Object.keys(localStorage);
            keys.forEach(key => {
                if (key.includes('firebase:authUser:') || 
                    key.includes('firebase:host:') || 
                    key.includes('firebase:heartbeat:')) {
                    localStorage.removeItem(key);
                }
            });
            
            // Clear sessionStorage
            sessionStorage.clear();
            
            // Re-initialize Firebase auth to ensure clean state
            try {
                // Get fresh auth instance
                auth = getAuth(app);
                
                // Re-setup auth state observer
                setupAuthStateObserver();
                
            } catch (error) {
                console.error('Auth re-initialization error:', error);
            }
            
            // Force show login screen immediately
            showLoginScreen();
            resetLoginForm();
            
            console.log('‚úÖ Force logout completed with auth re-initialization');
        };

        // Separate function for auth state observer setup (backup only)
        function setupAuthStateObserver() {
            onAuthStateChanged(auth, (user) => {
                console.log('üîÑ Auth state observer - User:', user ? 'LOGGED_IN' : 'LOGGED_OUT');
                
                document.getElementById('auth-loading').style.display = 'none';
                
                // Only handle logout case - login is handled explicitly by login functions
                if (!user && currentUser) {
                    // User was logged out
                    currentUser = null;
                    console.log('‚ùå User logged out, showing login screen');
                    showLoginScreen();
                    resetLoginForm();
                } else if (user && !currentUser) {
                    // This handles initial page load with existing auth
                    currentUser = user;
                    console.log('‚úÖ Initial auth state - showing main app');
                    showMainApp();
                    updateUserInfo(user);
                    updateAccountInfo(user);
                    loadDagboekEntries();
                    checkForLocalData();
                }
                // If user exists and currentUser exists, do nothing (login functions handle this)
            }, (error) => {
                console.error('‚ùå Auth state observer error:', error);
            });
        }

        // Helper functies
        function updateFirebaseStatus(type, message) {
            const statusElement = document.getElementById('firebase-status');
            statusElement.textContent = message;
            statusElement.className = `status-${type}`;
        }

        // Enhanced screen switching
        function showLoginScreen() {
            const loginScreen = document.getElementById('login-screen');
            const mainApp = document.getElementById('main-app');
            
            if (loginScreen && mainApp) {
                loginScreen.classList.remove('hidden');
                mainApp.classList.add('hidden');
                
                // Ensure login form is ready for use
                setTimeout(() => {
                    const emailField = document.getElementById('login-email');
                    if (emailField) {
                        emailField.focus(); // Focus on email field for better UX
                    }
                }, 100);
                
                console.log('‚úÖ Switched to login screen');
            }
        }

        function showMainApp() {
            document.getElementById('login-screen').classList.add('hidden');
            document.getElementById('main-app').classList.remove('hidden');
            
            // Setup tip refresh button after main app is shown
            setTimeout(() => {
                const tipRefreshBtn = document.getElementById('tip-refresh-btn');
                if (tipRefreshBtn) {
                    // Remove any existing listeners
                    tipRefreshBtn.removeEventListener('click', getNewTip);
                    // Add fresh listener
                    tipRefreshBtn.addEventListener('click', function(e) {
                        e.preventDefault();
                        console.log('üîÑ Tip refresh clicked in main app');
                        getNewTip();
                    });
                    console.log('‚úÖ Tip refresh button activated in main app');
                }
            }, 100);
        }

        // Fixed checkForLocalData that handles Firestore issues
        function checkForLocalData() {
            const localData = localStorage.getItem('ademruimte-entries');
            const migrationSection = document.getElementById('migration-section');
            
            if (localData && JSON.parse(localData).length > 0) {
                // Only show if we can use Firestore
                if (isFirebaseConnected && currentUser) {
                    migrationSection.style.display = 'block';
                } else {
                    migrationSection.style.display = 'none';
                }
            } else {
                migrationSection.style.display = 'none';
            }
        }

        // Wake Lock API for keeping screen on
        async function requestWakeLock() {
            try {
                if ('wakeLock' in navigator) {
                    wakeLock = await navigator.wakeLock.request('screen');
                    console.log('‚úÖ Wake lock activated - screen will stay on');
                    
                    wakeLock.addEventListener('release', () => {
                        console.log('Wake lock released');
                    });
                }
            } catch (error) {
                console.log('Wake lock not supported or failed:', error);
            }
        }

        async function releaseWakeLock() {
            if (wakeLock) {
                try {
                    await wakeLock.release();
                    wakeLock = null;
                    console.log('‚úÖ Wake lock released');
                } catch (error) {
                    console.log('Error releasing wake lock:', error);
                }
            }
        }

        // Load progress data
        function loadProgressData() {
            const stored = localStorage.getItem('ademruimte-progress');
            if (stored) {
                progressData = { ...progressData, ...JSON.parse(stored) };
            }
        }

        // Save progress data
        function saveProgressData() {
            localStorage.setItem('ademruimte-progress', JSON.stringify(progressData));
        }

        // Track session completion
        function trackSession(type, duration = null) {
            if (!progressData[type]) {
                progressData[type] = { sessions: 0, totalTime: 0, lastSession: null };
            }
            
            progressData[type].sessions++;
            if (duration) {
                progressData[type].totalTime += duration;
            }
            progressData[type].lastSession = new Date().toISOString();
            
            saveProgressData();
            console.log(`‚úÖ Tracked ${type} session:`, progressData[type]);
        }

        function updateUserInfo(user) {
            const userInfo = document.getElementById('user-info');
            const displayName = user.displayName || user.email;
            const shortName = displayName.length > 15 ? displayName.substring(0, 13) + '...' : displayName;
            
            userInfo.innerHTML = 'üëã ' + shortName;
        }

        // FIXED Authentication functions with correct Firebase v9+ imports
        window.signInWithGoogle = async function() {
            try {
                // Set persistence to local (keep signed in)
                await setPersistence(auth, browserLocalPersistence);
                
                const provider = new GoogleAuthProvider();
                
                // Add popup configuration to avoid cache issues
                provider.setCustomParameters({
                    prompt: 'select_account'
                });
                
                const result = await signInWithPopup(auth, provider);
                console.log('‚úÖ Google sign-in successful:', result.user.email);
                
                // Update global state
                currentUser = result.user;
                
                // Immediately switch to main app
                showMainApp();
                updateUserInfo(result.user);
                updateAccountInfo(result.user);
                loadDagboekEntries();
                checkForLocalData();
                
            } catch (error) {
                console.error('‚ùå Google sign-in error:', error);
                
                // Handle specific error cases
                if (error.code === 'auth/popup-blocked') {
                    alert('üö´ Popup geblokkeerd!\n\nKlik opnieuw om in te loggen. Zorg ervoor dat popups toegestaan zijn voor deze site.');
                } else if (error.code === 'auth/popup-closed-by-user') {
                    // User closed popup - no need to show error
                    console.log('User closed popup');
                } else if (error.code === 'auth/cancelled-popup-request') {
                    // Multiple popup requests - ignore
                    console.log('Popup request cancelled (multiple attempts)');
                } else {
                    alert('Google inloggen mislukt: ' + error.message);
                }
            }
        };

        window.showRegisterForm = function() {
            document.getElementById('register-modal').classList.add('show');
        };

        window.closeRegisterModal = function() {
            document.getElementById('register-modal').classList.remove('show');
            // Reset form
            document.getElementById('register-form').reset();
        };

        // FIXED Login form handler with correct Firebase v9+ imports
        function setupLoginFormHandler() {
            const loginForm = document.getElementById('login-form');
            if (!loginForm) {
                console.log('Login form not found, retrying...');
                setTimeout(setupLoginFormHandler, 200);
                return;
            }
            
            // Remove any existing listeners to prevent duplicates
            const newForm = loginForm.cloneNode(true);
            loginForm.parentNode.replaceChild(newForm, loginForm);
            
            // Add fresh event listener
            newForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                
                const email = document.getElementById('login-email').value.trim();
                const password = document.getElementById('login-password').value;
                const rememberMeCheckbox = document.getElementById('remember-me');
                const rememberMe = rememberMeCheckbox ? rememberMeCheckbox.checked : true;
                
                if (!email || !password) {
                    alert('Vul alle velden in');
                    return;
                }
                
                // Show loading state
                const submitBtn = newForm.querySelector('button[type="submit"]');
                const originalText = submitBtn.textContent;
                submitBtn.textContent = 'Inloggen...';
                submitBtn.disabled = true;
                
                try {
                    // Set persistence based on checkbox
                    if (rememberMe) {
                        await setPersistence(auth, browserLocalPersistence);
                    } else {
                        await setPersistence(auth, browserSessionPersistence);
                    }
                    
                    const result = await signInWithEmailAndPassword(auth, email, password);
                    console.log('‚úÖ Email sign-in successful');
                    
                    // Update global state
                    currentUser = result.user;
                    
                    // Immediately switch to main app
                    showMainApp();
                    updateUserInfo(result.user);
                    updateAccountInfo(result.user);
                    loadDagboekEntries();
                    checkForLocalData();
                    
                    // Restore button state
                    submitBtn.textContent = originalText;
                    submitBtn.disabled = false;
                    
                } catch (error) {
                    console.error('‚ùå Email sign-in error:', error);
                    
                    // Restore button state
                    submitBtn.textContent = originalText;
                    submitBtn.disabled = false;
                    
                    // User-friendly error messages
                    let errorMessage = 'Inloggen mislukt';
                    if (error.code === 'auth/user-not-found') {
                        errorMessage = 'Geen account gevonden met dit email';
                    } else if (error.code === 'auth/wrong-password') {
                        errorMessage = 'Verkeerd wachtwoord';
                    } else if (error.code === 'auth/invalid-email') {
                        errorMessage = 'Ongeldig email adres';
                    } else {
                        errorMessage += ': ' + error.message;
                    }
                    
                    alert(errorMessage);
                }
            });
            
            console.log('‚úÖ Login form handler setup complete');
        }

        // FIXED Register form handler with correct Firebase v9+ imports
        function setupRegisterFormHandler() {
            const registerForm = document.getElementById('register-form');
            if (!registerForm) {
                setTimeout(setupRegisterFormHandler, 200);
                return;
            }
            
            // Remove any existing listeners
            const newForm = registerForm.cloneNode(true);
            registerForm.parentNode.replaceChild(newForm, registerForm);
            
            // Add fresh event listener
            newForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                
                const name = document.getElementById('register-name').value.trim();
                const email = document.getElementById('register-email').value.trim();
                const password = document.getElementById('register-password').value;
                
                if (!name || !email || !password) {
                    alert('Vul alle velden in');
                    return;
                }
                
                if (password.length < 6) {
                    alert('Wachtwoord moet minimaal 6 karakters zijn');
                    return;
                }
                
                try {
                    // Set persistence to local (keep signed in)
                    await setPersistence(auth, browserLocalPersistence);
                    
                    const result = await createUserWithEmailAndPassword(auth, email, password);
                    
                    // Update user profile with name
                    await updateProfile(result.user, {
                        displayName: name
                    });
                    
                    console.log('‚úÖ Account created successfully');
                    
                    // Update global state
                    currentUser = result.user;
                    
                    // Close modal and switch to main app
                    closeRegisterModal();
                    showMainApp();
                    updateUserInfo(result.user);
                    updateAccountInfo(result.user);
                    loadDagboekEntries();
                    checkForLocalData();
                    
                } catch (error) {
                    console.error('‚ùå Registration error:', error);
                    
                    let errorMessage = 'Account aanmaken mislukt';
                    if (error.code === 'auth/email-already-in-use') {
                        errorMessage = 'Dit email adres is al in gebruik';
                    } else if (error.code === 'auth/weak-password') {
                        errorMessage = 'Wachtwoord is te zwak';
                    } else {
                        errorMessage += ': ' + error.message;
                    }
                    
                    alert(errorMessage);
                }
            });
        }

        // Tips functionaliteit
        const tips = [
            "Gaapaanvallen zijn een waarschuwingssignaal, geen bedreiging. Gebruik ze als mogelijkheid om preventief in te grijpen.",
            "Bij luchthonger: onthoud dat je lichaam genoeg zuurstof heeft. Het gevoel ligt niet aan een tekort.",
            "De Buteyko-methode helpt je CO2-tolerantie verhogen, wat hyperventilatie kan verminderen.",
            "Een korte wandeling na intensief denkwerk helpt je lichaam 'omschakelen' van werk naar rust.",
            "Als je merkt dat je gaat gapen: probeer je lippen op elkaar te houden en door je neus te ademen.",
            "EMDR-zelfhulp is ondersteunend, maar bij ernstige klachten zoek je best professionele hulp.",
            "Bijhouden van patronen in je dagboek helpt om je triggers te herkennen.",
            "Het gevoel van luchthonger gaat altijd vorbij - geef het tijd en gebruik je technieken.",
            "
