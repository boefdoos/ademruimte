<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#06b6d4">
    <meta name="description" content="Ademruimte - Je persoonlijke ruimte voor ademhalingsoefeningen en hyperventilatie begeleiding">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <title>Ademruimte - Hyperventilatie Helper</title>
    
    <!-- Preload kritieke resources -->
    <link rel="preconnect" href="https://www.gstatic.com">
    <link rel="preconnect" href="https://unpkg.com">

<style>
    /* CSS Custom Properties voor consistentie */
    :root {
        --primary-gradient: linear-gradient(135deg, #06b6d4 0%, #10b981 50%, #3b82f6 100%);
        --card-background: rgba(255, 255, 255, 0.95);
        --text-dark: #1f2937;
        --text-light: #6b7280;
        --border-radius: 1rem;
        --shadow-sm: 0 4px 15px rgba(0, 0, 0, 0.1);
        --shadow-md: 0 8px 32px rgba(0, 0, 0, 0.1);
        --transition-base: all 0.3s ease;
        --touch-target: 44px;
    }

    /* Reset en basis styling */
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, "Apple Color Emoji", "Segoe UI Emoji", sans-serif;
        background: var(--primary-gradient);
        min-height: 100vh;
        line-height: 1.6;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        overflow-x: hidden;
    }

    /* Skip link voor toegankelijkheid */
    .skip-link {
        position: absolute;
        top: -40px;
        left: 6px;
        background: var(--text-dark);
        color: white;
        padding: 8px;
        text-decoration: none;
        border-radius: 4px;
        z-index: 1000;
    }
    
    .skip-link:focus {
        top: 6px;
    }

    /* Verbeterde header */
    header {
        background: linear-gradient(135deg, #06b6d4, #10b981);
        color: white;
        padding: clamp(1rem, 3vw, 2rem);
        text-align: center;
        position: relative;
        min-height: 60px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        box-shadow: var(--shadow-md);
        backdrop-filter: blur(10px);
    }

    header h1 {
        font-size: clamp(1.2rem, 4vw, 2rem);
        font-weight: 700;
        margin: 0 0 0.5rem 0;
        letter-spacing: -0.02em;
        text-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    header p {
        font-size: clamp(0.7rem, 2vw, 0.9rem);
        opacity: 0.95;
        margin: 0;
    }

    .user-info {
        position: absolute;
        top: 1rem;
        right: 1rem;
        font-size: 0.8rem;
        color: rgba(255,255,255,0.9);
        max-width: 140px;
        word-break: break-word;
        text-align: right;
    }

    /* Geoptimaliseerde navigatie */
    .nav-tabs {
        background: var(--card-background);
        backdrop-filter: blur(20px);
        border-bottom: 2px solid rgba(102, 126, 234, 0.2);
        padding: 0.5rem;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
        box-shadow: var(--shadow-sm);
        scrollbar-width: none;
        -ms-overflow-style: none;
    }

    .nav-tabs::-webkit-scrollbar {
        display: none;
    }

    .nav-tabs button {
        background: none;
        border: none;
        padding: 0.75rem 1rem;
        margin-right: 0.25rem;
        border-radius: 0.75rem;
        cursor: pointer;
        font-size: 0.85rem;
        font-weight: 500;
        transition: var(--transition-base);
        white-space: nowrap;
        min-height: var(--touch-target);
        touch-action: manipulation;
        color: var(--text-light);
        position: relative;
        outline: none;
        font-family: inherit;
    }

    .nav-tabs button:focus-visible {
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.3);
    }

    .nav-tabs button.active {
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
        box-shadow: var(--shadow-sm);
        transform: translateY(-1px);
    }

    .nav-tabs button:hover:not(.active) {
        background: rgba(102, 126, 234, 0.1);
        color: #667eea;
    }

    /* Container optimalisaties */
    .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: clamp(1rem, 3vw, 2rem);
        min-height: calc(100vh - 120px);
    }

    /* Verbeterde card styling */
    .card {
        background: var(--card-background);
        backdrop-filter: blur(20px);
        border-radius: var(--border-radius);
        padding: clamp(1rem, 3vw, 2rem);
        margin-bottom: 1.5rem;
        box-shadow: var(--shadow-md);
        border: 1px solid rgba(255, 255, 255, 0.2);
        transition: var(--transition-base);
    }

    .card:hover {
        transform: translateY(-2px);
        box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
    }

    .card h2 {
        color: var(--text-dark);
        margin-bottom: 1rem;
        font-size: clamp(1.25rem, 4vw, 1.75rem);
        font-weight: 700;
        background: linear-gradient(135deg, #06b6d4, #10b981);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    /* Toegankelijke button styling */
    .btn {
        padding: 1rem 1.5rem;
        border: none;
        border-radius: 0.75rem;
        cursor: pointer;
        font-size: 0.95rem;
        font-weight: 600;
        transition: var(--transition-base);
        text-align: center;
        display: inline-block;
        text-decoration: none;
        min-height: var(--touch-target);
        touch-action: manipulation;
        user-select: none;
        position: relative;
        overflow: hidden;
        box-shadow: var(--shadow-sm);
        outline: none;
        font-family: inherit;
    }

    .btn:focus-visible {
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.3), var(--shadow-sm);
    }

    .btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none !important;
    }

    .btn:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
    }

    .btn-primary {
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
    }

    .btn-green {
        background: linear-gradient(135deg, #10b981, #059669);
        color: white;
    }

    .btn-red {
        background: linear-gradient(135deg, #ef4444, #dc2626);
        color: white;
    }

    .btn-cyan {
        background: linear-gradient(135deg, #06b6d4, #0891b2);
        color: white;
    }

    /* Verbeterde grid layout */
    .grid {
        display: grid;
        gap: 1.5rem;
        grid-template-columns: repeat(auto-fit, minmax(min(280px, 100%), 1fr));
    }

    /* Loading states */
    .loading {
        opacity: 0.6;
        pointer-events: none;
        position: relative;
    }

    .loading::after {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        width: 20px;
        height: 20px;
        margin: -10px 0 0 -10px;
        border: 2px solid #f3f4f6;
        border-top: 2px solid #3b82f6;
        border-radius: 50%;
        animation: spin 1s linear infinite;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    /* Verbeterde form styling */
    .form-group {
        margin-bottom: 1rem;
    }

    .form-label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: 500;
        color: var(--text-dark);
        font-size: 0.9rem;
    }

    .form-input, .form-select, .form-textarea {
        width: 100%;
        padding: 0.75rem;
        border: 2px solid #e5e7eb;
        border-radius: 0.5rem;
        font-size: 0.9rem;
        min-height: var(--touch-target);
        font-family: inherit;
        transition: border-color 0.2s ease;
    }

    .form-input:focus, .form-select:focus, .form-textarea:focus {
        outline: none;
        border-color: #06b6d4;
        box-shadow: 0 0 0 3px rgba(6, 182, 212, 0.1);
    }

    /* Alert verbeteringen */
    .alert {
        padding: 1rem;
        border-radius: 0.5rem;
        margin-bottom: 1rem;
        font-size: 0.9rem;
        border-left: 4px solid;
    }

    .alert-info {
        background: #dbeafe;
        border-color: #3b82f6;
        color: #1e40af;
    }

    .alert-success {
        background: #d1fae5;
        border-color: #10b981;
        color: #065f46;
    }

    .alert-warning {
        background: #fef3c7;
        border-color: #f59e0b;
        color: #92400e;
    }

    .alert-danger {
        background: #fee2e2;
        border-color: #ef4444;
        color: #991b1b;
    }

    /* Modals */
    .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.5);
        z-index: 1000;
        padding: 1rem;
    }

    .modal.show {
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .modal-content {
        background: white;
        border-radius: 0.75rem;
        padding: 1.5rem;
        max-width: 400px;
        width: 100%;
        max-height: 90vh;
        overflow-y: auto;
        position: relative;
    }

    .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
    }

    .close-btn {
        background: none;
        border: none;
        font-size: 1.5rem;
        cursor: pointer;
        color: var(--text-light);
        min-width: 40px;
        min-height: 40px;
        border-radius: 50%;
        transition: var(--transition-base);
    }

    .close-btn:hover {
        background: rgba(0,0,0,0.1);
        color: var(--text-dark);
    }

    /* Utility classes */
    .hidden {
        display: none !important;
    }

    .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
    }

    /* Responsive optimalisaties */
    @media (max-width: 768px) {
        .container {
            padding: 1rem;
        }
        
        .modal-content {
            margin: 1rem;
            padding: 1rem;
        }
        
        .btn {
            padding: 1rem;
            font-size: 0.9rem;
        }
    }

    @media (max-height: 600px) and (orientation: landscape) {
        header {
            padding: 0.5rem 1rem;
        }
        
        .container {
            padding: 0.5rem;
        }
    }

    /* Print styling */
    @media print {
        body {
            background: white;
            color: black;
        }
        
        .nav-tabs, .btn, header {
            display: none;
        }
    }

    /* High contrast mode support */
    @media (prefers-contrast: high) {
        .card {
            border: 2px solid;
        }
        
        .btn {
            border: 2px solid;
        }
    }

    /* Reduced motion support */
    @media (prefers-reduced-motion: reduce) {
        *, *::before, *::after {
            animation-duration: 0.01ms !important;
            animation-iteration-count: 1 !important;
            transition-duration: 0.01ms !important;
        }
    }

    /* Dark mode preparation (voor toekomstige implementatie) */
    @media (prefers-color-scheme: dark) {
        :root {
            --card-background: rgba(31, 41, 55, 0.95);
            --text-dark: #f9fafb;
            --text-light: #d1d5db;
        }
    }
</style>
</head>

<body>
    <!-- Skip link voor toegankelijkheid -->
    <a href="#main-content" class="skip-link">Spring naar hoofdinhoud</a>

    <header role="banner">
        <div class="user-info" id="user-info" aria-live="polite">
            <div class="loading" id="auth-loading" aria-label="Bezig met inloggen..."></div>
        </div>
        
        <h1>Ademruimte</h1>
        <p>Je veilige ruimte voor ademhalingsoefeningen</p>
    </header>

    <!-- Login Screen -->
    <div id="login-screen" role="main">
        <div style="max-width: 400px; margin: 2rem auto; padding: 0 1rem;">
            <div class="card">
                <h2 style="text-align: center; margin-bottom: 1.5rem;">
                    Welkom bij Ademruimte
                </h2>
                
                <p style="text-align: center; margin-bottom: 2rem; color: var(--text-light);">
                    Log in om je vooruitgang op te slaan en te synchroniseren.
                </p>

                <!-- Google Login -->
                <button class="btn btn-primary" 
                        onclick="signInWithGoogle()" 
                        style="width: 100%; margin-bottom: 1rem;"
                        aria-label="Inloggen met Google account">
                    🔐 Doorgaan met Google
                </button>

                <div style="text-align: center; margin: 1.5rem 0; position: relative; color: var(--text-light);">
                    <span style="background: white; padding: 0 1rem; position: relative; z-index: 2;">of</span>
                    <div style="position: absolute; top: 50%; left: 0; right: 0; height: 1px; background: #e5e7eb; z-index: 1;"></div>
                </div>

                <!-- Email/Password Login -->
                <form id="login-form" novalidate>
                    <div class="form-group">
                        <label for="login-email" class="form-label">E-mail:</label>
                        <input type="email" 
                               id="login-email" 
                               class="form-input" 
                               placeholder="jouw@email.com" 
                               required 
                               autocomplete="email">
                    </div>

                    <div class="form-group">
                        <label for="login-password" class="form-label">Wachtwoord:</label>
                        <input type="password" 
                               id="login-password" 
                               class="form-input" 
                               placeholder="Wachtwoord" 
                               required 
                               autocomplete="current-password">
                    </div>

                    <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 1.5rem;">
                        <input type="checkbox" id="remember-me" checked aria-describedby="remember-help">
                        <label for="remember-me" style="margin: 0; cursor: pointer;">Ingelogd blijven</label>
                        <span id="remember-help" class="sr-only">Vink aan om ingelogd te blijven op dit apparaat</span>
                    </div>

                    <button type="submit" class="btn btn-primary" style="width: 100%; margin-bottom: 1rem;">
                        Inloggen
                    </button>
                </form>

                <div style="text-align: center;">
                    <p style="color: var(--text-light); font-size: 0.875rem; margin-bottom: 1rem;">
                        Nog geen account?
                    </p>
                    <button class="btn btn-green" onclick="showRegisterForm()" style="width: 100%;">
                        Account Aanmaken
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Register Modal -->
    <div id="register-modal" class="modal" role="dialog" aria-labelledby="register-title">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="register-title">Account Aanmaken</h3>
                <button class="close-btn" onclick="closeRegisterModal()" aria-label="Sluit registratie venster">&times;</button>
            </div>
            
            <form id="register-form" novalidate>
                <div class="form-group">
                    <label for="register-name" class="form-label">Naam:</label>
                    <input type="text" 
                           id="register-name" 
                           class="form-input" 
                           placeholder="Jouw naam" 
                           required 
                           autocomplete="name">
                </div>

                <div class="form-group">
                    <label for="register-email" class="form-label">E-mail:</label>
                    <input type="email" 
                           id="register-email" 
                           class="form-input" 
                           placeholder="jouw@email.com" 
                           required 
                           autocomplete="email">
                </div>

                <div class="form-group">
                    <label for="register-password" class="form-label">Wachtwoord:</label>
                    <input type="password" 
                           id="register-password" 
                           class="form-input" 
                           placeholder="Minimaal 6 karakters" 
                           required 
                           minlength="6" 
                           autocomplete="new-password">
                </div>

                <div style="display: flex; gap: 0.5rem; margin-top: 1.5rem;">
                    <button type="submit" class="btn btn-green" style="flex: 1;">
                        Account Aanmaken
                    </button>
                    <button type="button" class="btn" onclick="closeRegisterModal()" style="flex: 1;">
                        Annuleren
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Main App -->
    <div id="main-app" class="hidden">
        <nav class="nav-tabs" role="navigation" aria-label="Hoofdnavigatie">
            <button class="tab-btn active" data-tab="dashboard" aria-selected="true">🏠 Dashboard</button>
            <button class="tab-btn" data-tab="crisis" aria-selected="false">🚨 Crisis</button>
            <button class="tab-btn" data-tab="buteyko" aria-selected="false">🌬️ Buteyko</button>
            <button class="tab-btn" data-tab="ritueel" aria-selected="false">🕐 Ritueel</button>
            <button class="tab-btn" data-tab="gapen" aria-selected="false">🥱 Gapen</button>
            <button class="tab-btn" data-tab="emdr" aria-selected="false">💜 EMDR</button>
            <button class="tab-btn" data-tab="dagboek" aria-selected="false">📖 Dagboek</button>
        </nav>

        <main id="main-content" class="container">
            <!-- Dashboard Tab -->
            <div id="dashboard" class="tab-content" role="tabpanel" aria-labelledby="dashboard-tab">
                <div class="card" style="text-align: center;">
                    <h2>🌬️ Welkom bij Ademruimte</h2>
                    <p style="color: var(--text-light); max-width: 600px; margin: 0 auto;">
                        Je persoonlijke ruimte voor ademhalingsoefeningen en hyperventilatie begeleiding. 
                        Neem de tijd om te ontspannen en ontdek welke technieken het beste voor jou werken.
                    </p>
                </div>

                <div class="grid">
                    <div class="card">
                        <h3>🚨 Crisis Hulp</h3>
                        <p>Voor wanneer je luchthonger voelt opkomen</p>
                        <button class="btn btn-red" onclick="showTab('crisis')">Open Crisis Hulp</button>
                    </div>

                    <div class="card">
                        <h3>🌬️ Buteyko Ademhaling</h3>
                        <p>CO2 tolerantie training</p>
                        <button class="btn btn-cyan" onclick="showTab('buteyko')">Start Buteyko</button>
                    </div>

                    <div class="card">
                        <h3>🕐 Afkoel Ritueel</h3>
                        <p>Na intensief denkwerk</p>
                        <button class="btn btn-green" onclick="showTab('ritueel')">Start Ritueel</button>
                    </div>

                    <div class="card">
                        <h3>🥱 Gaap Preventie</h3>
                        <p>Technieken voor gaapaanvallen</p>
                        <button class="btn" onclick="showTab('gapen')" style="background: linear-gradient(135deg, #f59e0b, #d97706); color: white;">Bekijk Technieken</button>
                    </div>

                    <div class="card">
                        <h3>💜 EMDR Zelfhulp</h3>
                        <p>Voor luchthonger-gevoelens</p>
                        <button class="btn" onclick="showTab('emdr')" style="background: linear-gradient(135deg, #8b5cf6, #7c3aed); color: white;">Start EMDR</button>
                    </div>

                    <div class="card">
                        <h3>📖 Dagboek</h3>
                        <p>Bijhouden van patronen</p>
                        <button class="btn btn-primary" onclick="showTab('dagboek')">Open Dagboek</button>
                    </div>
                </div>

                <div class="alert alert-info">
                    <strong>💡 Tip van de dag:</strong> 
                    <span id="daily-tip">Gaapaanvallen zijn een waarschuwingssignaal, geen bedreiging. Gebruik ze als mogelijkheid om preventief in te grijpen.</span>
                    <button id="tip-refresh-btn" 
                            style="background: none; border: none; color: #0891b2; cursor: pointer; margin-left: 0.5rem; font-weight: 600; padding: 0.25rem; border-radius: 0.25rem; transition: var(--transition-base);" 
                            onmouseover="this.style.background='rgba(8,145,178,0.1)'" 
                            onmouseout="this.style.background='none'" 
                            aria-label="Nieuwe tip laden">🔄</button>
                </div>

                <!-- Account Settings -->
                <div class="card">
                    <h3>👤 Account</h3>
                    <div id="account-info" style="margin-bottom: 1rem;">
                        <!-- Account info wordt hier ingevuld -->
                    </div>
                    <button class="btn btn-red" onclick="performLogout()">
                        🚪 Uitloggen
                    </button>
                </div>
            </div>

            <!-- Crisis Tab -->
            <div id="crisis" class="tab-content hidden" role="tabpanel" aria-labelledby="crisis-tab">
                <div class="card">
                    <h2>🚨 Crisis Hulp - Luchthonger</h2>
                    <p>Voor wanneer je dat benauwde gevoel voelt opkomen</p>
                </div>

                <div class="card">
                    <h3>1. Paradoxale Ademhaling</h3>
                    <p>Start met bewust zeer kleine, korte ademhalingen. Na 3-4 van deze mini-ademhalingen, probeer een iets langere uitademing.</p>
                </div>

                <div class="card">
                    <h3>2. Purse-lip Ademhaling</h3>
                    <p>Tuut je lippen bij het uitademen om lichte weerstand te creëren. Dit helpt bij luchthonger en stabiliseert CO2-niveaus.</p>
                </div>

                <div class="card">
                    <h3>3. IJswater Techniek</h3>
                    <p>Breng iets kouds tegen je gezicht (vooral rond wangen en ogen) om de duikreflex te activeren.</p>
                </div>

                <div class="card">
                    <h3>4. Herframing</h3>
                    <p>"Dit is geen echt zuurstoftekort, dit is een sensatie die voorbij zal gaan. Mijn lichaam krijgt genoeg zuurstof."</p>
                </div>

                <div class="card">
                    <h3>5-4-3-2-1 Grounding</h3>
                    <ul style="list-style-type: none; margin: 1rem 0;">
                        <li style="padding: 0.5rem 0; border-bottom: 1px solid #f3f4f6;">✓ 5 dingen die je ZIET</li>
                        <li style="padding: 0.5rem 0; border-bottom: 1px solid #f3f4f6;">✓ 4 dingen die je VOELT</li>
                        <li style="padding: 0.5rem 0; border-bottom: 1px solid #f3f4f6;">✓ 3 dingen die je HOORT</li>
                        <li style="padding: 0.5rem 0; border-bottom: 1px solid #f3f4f6;">✓ 2 dingen die je RUIKT</li>
                        <li style="padding: 0.5rem 0;">✓ 1 ding dat je PROEFT</li>
                    </ul>
                </div>
            </div>

            <!-- Placeholder voor andere tabs -->
            <div id="buteyko" class="tab-content hidden" role="tabpanel" aria-labelledby="buteyko-tab">
                <div class="card">
                    <h2>🌬️ Buteyko Ademhaling</h2>
                    <p>Verbeter je CO2 tolerantie en verminder hyperventilatie neiging</p>
                </div>
                
                <div class="alert alert-info">
                    <strong>💡 Hoe het werkt:</strong> Buteyko ademhaling helpt je lichaam wennen aan hogere CO2 niveaus, wat hyperventilatie-episodes kan verminderen.
                </div>
                
                <div class="card">
                    <h3>Binnenkort beschikbaar</h3>
                    <p>Deze functie wordt nog verder ontwikkeld voor een optimale ervaring.</p>
                </div>
            </div>

            <div id="ritueel" class="tab-content hidden" role="tabpanel" aria-labelledby="ritueel-tab">
                <div class="card">
                    <h2>🕐 Afkoel Ritueel</h2>
                    <p>Voor na periodes van intensief denkwerk (5-10 minuten)</p>
                </div>
                
                <div class="card">
                    <h3>Binnenkort beschikbaar</h3>
                    <p>Deze functie wordt nog verder ontwikkeld voor een optimale ervaring.</p>
                </div>
            </div>

            <div id="gapen" class="tab-content hidden" role="tabpanel" aria-labelledby="gapen-tab">
                <div class="card">
                    <h2>🥱 Gaap Preventie Technieken</h2>
                    <p>Voor wanneer je die vervelende gaapaanvallen voelt opkomen</p>
                </div>

                <div class="card">
                    <h3>Lipremming-techniek</h3>
                    <p>Druk je lippen zachtjes op elkaar wanneer je een gaapneiging voelt. Laat de lucht langzaam door je neus in en uit gaan.</p>
                </div>

                <div class="card">
                    <h3>Mini-ademhalingen</h3>
                    <p>Neem bewust 3-4 zeer kleine, ondiepe ademhalingen door je neus. Hiermee voorkom je de grote 'zucht-ademhaling'.</p>
                </div>

                <div class="alert alert-info">
                    <strong>💡 Belangrijk om te onthouden:</strong> Gaapaanvallen zijn een waarschuwingssignaal, geen bedreiging. Ze geven je de kans om preventief in te grijpen voordat een volledige hyperventilatie-episode begint.
                </div>
            </div>

            <div id="emdr" class="tab-content hidden" role="tabpanel" aria-labelledby="emdr-tab">
                <div class="card">
                    <h2>💜 EMDR Zelfhulp</h2>
                    <p>Voor luchthonger-gevoelens (dit is ondersteuning, geen vervanging voor professionele EMDR)</p>
                </div>
                
                <div class="alert alert-warning">
                    <strong>⚠️ Gebruik dit alleen voor milde tot matige gevoelens. Stop als je je overweldigd voelt.</strong>
                </div>
                
                <div class="card">
                    <h3>Binnenkort beschikbaar</h3>
                    <p>Deze functie wordt nog verder ontwikkeld voor een optimale ervaring.</p>
                </div>
            </div>

            <div id="dagboek" class="tab-content hidden" role="tabpanel" aria-labelledby="dagboek-tab">
                <div class="card">
                    <h2>📖 Dagboek</h2>
                    <p>Overzicht van je sessies en vooruitgang</p>
                </div>
                
                <div class="card">
                    <h3>Binnenkort beschikbaar</h3>
                    <p>Deze functie wordt nog verder ontwikkeld voor een optimale ervaring.</p>
                </div>
            </div>
        </main>
    </div>

    <footer style="text-align: center; padding: 2rem 1rem; color: var(--text-light); font-size: 0.8rem;">
        <p>📞 In noodgevallen: contacteer altijd je huisarts of spoeddiensten</p>
        <div style="margin-top: 0.5rem;">
            <span id="connection-status" aria-live="polite">🔗 Verbindingsstatus wordt geladen...</span>
        </div>
    </footer>

<script type="module">
    // Verbeterde error handling en logging
    const LOG_LEVELS = {
        INFO: 'ℹ️',
        SUCCESS: '✅', 
        WARNING: '⚠️',
        ERROR: '❌'
    };

    function log(level, message, data = null) {
        const timestamp = new Date().toLocaleTimeString('nl-NL');
        console.log(`${LOG_LEVELS[level]} [${timestamp}] ${message}`, data || '');
    }

    // Enhanced app state management
    class AppState {
        constructor() {
            this.currentUser = null;
            this.currentTab = 'dashboard';
            this.isOnline = navigator.onLine;
            this.isFirebaseConnected = false;
            this.tips = [
                "Gaapaanvallen zijn een waarschuwingssignaal, geen bedreiging. Gebruik ze als mogelijkheid om preventief in te grijpen.",
                "Bij luchthonger: probeer paradoxale ademhaling - begin met zeer kleine, korte ademhalingen.",
                "CO2 is niet giftig! Een hoger CO2-niveau in je bloed is juist gezond en kalmerend.",
                "Buteyko ademhaling helpt je lichaam wennen aan hogere CO2 niveaus.",
                "Een koude kompres op je gezicht activeert de duikreflex en kalmeert het zenuwstelsel.",
                "Grounding technieken zoals 5-4-3-2-1 helpen je geest terug naar het hier en nu te brengen.",
                "Zachte ademhaling is effectiever dan diepe ademhaling bij hyperventilatie.",
                "Regelmatige oefening van ademhalingstechnieken vermindert de kans op episodes.",
                "Het bijhouden van patronen in je dagboek helpt je triggers te identificeren.",
                "Na intensief denkwerk heeft je lichaam een afkoel ritueel nodig om te ontspannen."
            ];
        }

        setUser(user) {
            this.currentUser = user;
            this.updateUI();
        }

        setConnectionStatus(isConnected) {
            this.isFirebaseConnected = isConnected;
            this.updateConnectionDisplay();
        }

        updateUI() {
            const userInfo = document.getElementById('user-info');
            const accountInfo = document.getElementById('account-info');
            
            if (this.currentUser && userInfo) {
                const displayName = this.currentUser.displayName || this.currentUser.email;
                const shortName = displayName.length > 15 ? displayName.substring(0, 13) + '...' : displayName;
                userInfo.innerHTML = '👋 ' + shortName;
            }

            if (this.currentUser && accountInfo) {
                accountInfo.innerHTML = 
                    '<p style="color: var(--text-light); font-size: 0.9rem;">' +
                    '<strong>Ingelogd als:</strong><br>' + 
                    (this.currentUser.displayName || this.currentUser.email) + 
                    '</p>';
            }
        }

        updateConnectionDisplay() {
            const status = document.getElementById('connection-status');
            if (status) {
                if (this.isFirebaseConnected) {
                    status.textContent = '🟢 Verbonden met cloud';
                    status.style.color = '#059669';
                } else if (this.isOnline) {
                    status.textContent = '🟡 Lokale modus';
                    status.style.color = '#f59e0b';
                } else {
                    status.textContent = '🔴 Offline';
                    status.style.color = '#ef4444';
                }
            }
        }

        getRandomTip() {
            return this.tips[Math.floor(Math.random() * this.tips.length)];
        }
    }

    // Initialize app state
    const appState = new AppState();

    // Improved Firebase initialization with better error handling
    let app, db, auth;

    async function initializeFirebase() {
        try {
            log('INFO', 'Initializing Firebase...');
            
            const { initializeApp } = await import("https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js");
            const { getFirestore } = await import("https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js");
            const { getAuth, onAuthStateChanged, setPersistence, browserLocalPersistence } = await import("https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js");

            const firebaseConfig = {
                apiKey: "AIzaSyBwDkmbKOzZAyIZW7-ud4qYr7xHyILCdzI",
                authDomain: "ademruimte-12c09.firebaseapp.com",
                projectId: "ademruimte-12c09",
                storageBucket: "ademruimte-12c09.firebasestorage.app",
                messagingSenderId: "744941871331",
                appId: "1:744941871331:web:c3ce24d814fe41314d25d6",
                measurementId: "G-SD2ZEYNMNY"
            };

            app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            auth = getAuth(app);

            // Set persistence
            await setPersistence(auth, browserLocalPersistence);

            // Setup auth state observer
            onAuthStateChanged(auth, (user) => {
                document.getElementById('auth-loading').style.display = 'none';
                
                if (user && !appState.currentUser) {
                    log('SUCCESS', 'User authenticated', user.email);
                    appState.setUser(user);
                    showMainApp();
                } else if (!user && appState.currentUser) {
                    log('INFO', 'User logged out');
                    appState.setUser(null);
                    showLoginScreen();
                }
            });

            appState.setConnectionStatus(true);
            log('SUCCESS', 'Firebase initialized successfully');

        } catch (error) {
            log('ERROR', 'Firebase initialization failed', error);
            appState.setConnectionStatus(false);
        }
    }

    // Enhanced screen management
    function showLoginScreen() {
        const loginScreen = document.getElementById('login-screen');
        const mainApp = document.getElementById('main-app');
        
        if (loginScreen && mainApp) {
            loginScreen.classList.remove('hidden');
            mainApp.classList.add('hidden');
            
            // Focus management
            setTimeout(() => {
                const emailField = document.getElementById('login-email');
                if (emailField) emailField.focus();
            }, 100);
        }
    }

    function showMainApp() {
        const loginScreen = document.getElementById('login-screen');
        const mainApp = document.getElementById('main-app');
        
        if (loginScreen && mainApp) {
            loginScreen.classList.add('hidden');
            mainApp.classList.remove('hidden');
            
            // Focus management
            const dashboard = document.querySelector('[data-tab="dashboard"]');
            if (dashboard) dashboard.focus();
        }
    }

    // Enhanced authentication functions
    window.signInWithGoogle = async function() {
        try {
            if (!auth) {
                throw new Error('Firebase niet geïnitialiseerd');
            }

            const { GoogleAuthProvider, signInWithPopup } = await import("https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js");
            
            const provider = new GoogleAuthProvider();
            provider.setCustomParameters({ prompt: 'select_account' });
            
            const result = await signInWithPopup(auth, provider);
            log('SUCCESS', 'Google sign-in successful', result.user.email);
            
        } catch (error) {
            log('ERROR', 'Google sign-in failed', error);
            
            let message = 'Google inloggen mislukt';
            if (error.code === 'auth/popup-blocked') {
                message = 'Popup geblokkeerd! Zorg ervoor dat popups toegestaan zijn.';
            } else if (error.code === 'auth/popup-closed-by-user') {
                return; // User cancelled, no need to show error
            }
            
            showUserMessage(message, 'error');
        }
    };

    window.performLogout = async function() {
        if (!confirm('Weet je zeker dat je wilt uitloggen?')) {
            return;
        }
        
        try {
            if (auth && auth.currentUser) {
                const { signOut } = await import("https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js");
                await signOut(auth);
            }
            
            appState.setUser(null);
            log('SUCCESS', 'User logged out successfully');
            
        } catch (error) {
            log('ERROR', 'Logout failed', error);
            // Force logout anyway
            appState.setUser(null);
            showLoginScreen();
        }
    };

    // Enhanced tab management with accessibility
    window.showTab = function(tabName) {
        // Hide all tabs
        document.querySelectorAll('.tab-content').forEach(tab => {
            tab.classList.add('hidden');
        });
        
        // Remove active from all buttons
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.classList.remove('active');
            btn.setAttribute('aria-selected', 'false');
        });
        
        // Show selected tab
        const selectedTab = document.getElementById(tabName);
        const selectedBtn = document.querySelector(`[data-tab="${tabName}"]`);
        
        if (selectedTab) {
            selectedTab.classList.remove('hidden');
        }
        
        if (selectedBtn) {
            selectedBtn.classList.add('active');
            selectedBtn.setAttribute('aria-selected', 'true');
        }
        
        appState.currentTab = tabName;
        log('INFO', `Switched to tab: ${tabName}`);
    };

    // Enhanced user feedback system
    function showUserMessage(message, type = 'info') {
        // Remove existing message
        const existing = document.querySelector('.user-message');
        if (existing) existing.remove();
        
        const messageEl = document.createElement('div');
        messageEl.className = `alert alert-${type} user-message`;
        messageEl.style.position = 'fixed';
        messageEl.style.top = '20px';
        messageEl.style.left = '50%';
        messageEl.style.transform = 'translateX(-50%)';
        messageEl.style.zIndex = '1001';
        messageEl.style.maxWidth = '90vw';
        messageEl.textContent = message;
        messageEl.setAttribute('role', 'alert');
        
        document.body.appendChild(messageEl);
        
        // Auto-remove after 5 seconds
        setTimeout(() => {
            if (messageEl.parentNode) {
                messageEl.remove();
            }
        }, 5000);
    }

    // Enhanced form handling
    function setupForms() {
        const loginForm = document.getElementById('login-form');
        const registerForm = document.getElementById('register-form');
        
        if (loginForm) {
            loginForm.addEventListener('submit', handleLogin);
        }
        
        if (registerForm) {
            registerForm.addEventListener('submit', handleRegister);
        }
    }

    async function handleLogin(e) {
        e.preventDefault();
        
        const email = document.getElementById('login-email').value.trim();
        const password = document.getElementById('login-password').value;
        
        if (!email || !password) {
            showUserMessage('Vul alle velden in', 'warning');
            return;
        }
        
        const submitBtn = e.target.querySelector('button[type="submit"]');
        const originalText = submitBtn.textContent;
        
        try {
            submitBtn.textContent = 'Bezig met inloggen...';
            submitBtn.disabled = true;
            
            if (!auth) {
                throw new Error('Firebase niet geïnitialiseerd');
            }
            
            const { signInWithEmailAndPassword } = await import("https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js");
            await signInWithEmailAndPassword(auth, email, password);
            
            log('SUCCESS', 'Email sign-in successful');
            
        } catch (error) {
            log('ERROR', 'Email sign-in failed', error);
            
            let message = 'Inloggen mislukt';
            if (error.code === 'auth/user-not-found') {
                message = 'Geen account gevonden met dit email';
            } else if (error.code === 'auth/wrong-password') {
                message = 'Verkeerd wachtwoord';
            } else if (error.code === 'auth/invalid-email') {
                message = 'Ongeldig email adres';
            }
            
            showUserMessage(message, 'error');
            
        } finally {
            submitBtn.textContent = originalText;
            submitBtn.disabled = false;
        }
    }

    async function handleRegister(e) {
        e.preventDefault();
        
        const name = document.getElementById('register-name').value.trim();
        const email = document.getElementById('register-email').value.trim();
        const password = document.getElementById('register-password').value;
        
        if (!name || !email || !password) {
            showUserMessage('Vul alle velden in', 'warning');
            return;
        }
        
        if (password.length < 6) {
            showUserMessage('Wachtwoord moet minimaal 6 karakters zijn', 'warning');
            return;
        }
        
        try {
            if (!auth) {
                throw new Error('Firebase niet geïnitialiseerd');
            }
            
            const { createUserWithEmailAndPassword, updateProfile } = await import("https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js");
            
            const result = await createUserWithEmailAndPassword(auth, email, password);
            await updateProfile(result.user, { displayName: name });
            
            log('SUCCESS', 'Account created successfully');
            closeRegisterModal();
            showUserMessage('Account succesvol aangemaakt!', 'success');
            
        } catch (error) {
            log('ERROR', 'Registration failed', error);
            
            let message = 'Account aanmaken mislukt';
            if (error.code === 'auth/email-already-in-use') {
                message = 'Dit email adres is al in gebruik';
            } else if (error.code === 'auth/weak-password') {
                message = 'Wachtwoord is te zwak';
            }
            
            showUserMessage(message, 'error');
        }
    }

    // Modal management
    window.showRegisterForm = function() {
        document.getElementById('register-modal').classList.add('show');
        
        // Focus management
        setTimeout(() => {
            const nameField = document.getElementById('register-name');
            if (nameField) nameField.focus();
        }, 100);
    };

    window.closeRegisterModal = function() {
        document.getElementById('register-modal').classList.remove('show');
        document.getElementById('register-form').reset();
    };

    // Tip management
    function setRandomTip() {
        const tipElement = document.getElementById('daily-tip');
        if (tipElement) {
            tipElement.textContent = appState.getRandomTip();
        }
    }

    window.getNewTip = function() {
        setRandomTip();
        showUserMessage('Nieuwe tip geladen! 💡', 'success');
    };

    // Network status monitoring
    function setupNetworkMonitoring() {
        window.addEventListener('online', () => {
            appState.isOnline = true;
            appState.updateConnectionDisplay();
            log('INFO', 'Network connection restored');
        });

        window.addEventListener('offline', () => {
            appState.isOnline = false;
            appState.updateConnectionDisplay();
            log('WARNING', 'Network connection lost');
        });
    }

    // Keyboard navigation enhancements
    function setupKeyboardNavigation() {
        document.addEventListener('keydown', (e) => {
            // Tab navigation with arrow keys
            if (e.key === 'ArrowLeft' || e.key === 'ArrowRight') {
                const activeTab = document.querySelector('.tab-btn.active');
                if (activeTab && document.activeElement === activeTab) {
                    e.preventDefault();
                    
                    const tabs = Array.from(document.querySelectorAll('.tab-btn'));
                    const currentIndex = tabs.indexOf(activeTab);
                    
                    let nextIndex;
                    if (e.key === 'ArrowLeft') {
                        nextIndex = currentIndex > 0 ? currentIndex - 1 : tabs.length - 1;
                    } else {
                        nextIndex = currentIndex < tabs.length - 1 ? currentIndex + 1 : 0;
                    }
                    
                    tabs[nextIndex].focus();
                    tabs[nextIndex].click();
                }
            }
            
            // Escape key to close modals
            if (e.key === 'Escape') {
                const modal = document.querySelector('.modal.show');
                if (modal) {
                    modal.classList.remove('show');
                }
            }
        });
    }

    // Initialize app
    document.addEventListener('DOMContentLoaded', async function() {
        log('INFO', 'Starting Ademruimte app initialization');
        
        try {
            // Initialize components
            await initializeFirebase();
            setupForms();
            setupNetworkMonitoring();
            setupKeyboardNavigation();
            setRandomTip();
            
            // Setup tab navigation
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const tab = btn.getAttribute('data-tab');
                    showTab(tab);
                });
            });
            
            // Setup tip refresh button
            const tipRefreshBtn = document.getElementById('tip-refresh-btn');
            if (tipRefreshBtn) {
                tipRefreshBtn.addEventListener('click', getNewTip);
            }
            
            // Initial connection status
            appState.updateConnectionDisplay();
            
            log('SUCCESS', 'App initialization completed successfully');
            
        } catch (error) {
            log('ERROR', 'App initialization failed', error);
            showUserMessage('Er is een fout opgetreden bij het laden van de app', 'error');
        }
    });

    // Cleanup on page unload
    window.addEventListener('beforeunload', () => {
        log('INFO', 'App shutting down');
    });
</script>

</body>
</html>
